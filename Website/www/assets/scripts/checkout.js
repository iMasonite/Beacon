(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,i(a.key),a)}}function n(e,t,n){return(t=i(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(t){var n=function(t,n){if("object"!==e(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var a=i.call(t,"string");if("object"!==e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===e(n)?n:String(n)}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,i;return n=e,i=[{key:"show",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Ok";return this.confirm(e,t,n,null)}},{key:"confirm",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Ok",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Cancel";return new Promise((function(r,o){var c=document.getElementById("overlay"),s=document.getElementById("dialog"),l=document.getElementById("dialog_message"),u=document.getElementById("dialog_explanation"),d=document.getElementById("dialog_action_button"),h=document.getElementById("dialog_cancel_button");c&&s&&l&&u&&d&&h?(c.className="exist",s.className="exist",setTimeout((function(){c.className="exist visible",s.className="exist visible"}),10),l.innerText=e,u.innerText=n||"",d.clickHandler&&d.removeEventListener("click",d.clickHandler),h.clickHandler&&h.removeEventListener("click",h.clickHandler),d.clickHandler=function(){t.hide(),setTimeout((function(){r()}),300)},d.addEventListener("click",d.clickHandler),d.innerText=i,a?(h.clickHandler=function(){t.hide(),setTimeout((function(){o()}),300)},h.addEventListener("click",h.clickHandler),h.innerText=a):h.className="hidden"):o()}))}},{key:"hide",value:function(){var e=document.getElementById("overlay"),t=document.getElementById("dialog");e&&t&&(e.className="exist",t.className="exist",setTimeout((function(){e.className="",t.className=""}),300))}},{key:"showModal",value:function(e){var t=this;if(!this.activeModal){var n=document.getElementById("overlay"),i=document.getElementById(e);n&&i&&(n.classList.add("exist"),i.classList.add("exist"),this.activeModal=e,setTimeout((function(){n.classList.add("visible"),i.classList.add("visible")}),10),this.viewportWatcher=setInterval((function(){if(t.activeModal){document.querySelectorAll("#".concat(t.activeModal," .modal-content .content")).forEach((function(e){i.classList.toggle("scrolled",e.scrollHeight>e.clientHeight)}));var e=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0);i.classList.toggle("centered",i.clientHeight>.75*e)}}),100))}}},{key:"hideModal",value:function(){var e=this;return new Promise((function(t,n){if(e.activeModal){var i=document.getElementById("overlay"),a=document.getElementById(e.activeModal);i&&a?(e.viewportWatcher&&(clearInterval(e.viewportWatcher),e.viewportWatcher=null),i.classList.remove("visible"),a.classList.remove("visible"),setTimeout((function(){i.classList.remove("exist"),a.classList.remove("exist"),e.activeModal=null,t()}),300)):n()}else n()}))}}],null&&t(n.prototype,null),i&&t(n,i),Object.defineProperty(n,"prototype",{writable:!1}),e}();function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,a=function(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key),"symbol"===r(a)?a:String(a)),i)}var a}n(a,"activeModal",null),n(a,"viewportWatcher",null);var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"prepareResponse",value:function(e){return{xhr:e,status:e.status,statusText:e.statusText,body:e.responseText,success:e.status>=200&&e.status<300||304===e.status}}},{key:"start",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new Promise((function(o,c){var s=new XMLHttpRequest;if(s.open(e,t,!0),"object"===r(a)&&null!==a&&!1===Array.isArray(a))for(var l=0,u=Object.keys(a);l<u.length;l++){var d=u[l];s.setRequestHeader(d,a[d])}s.onload=function(){var e=n.prepareResponse(s);e.success?o(e):c(e)},s.onerror=function(){c(n.prepareResponse(s))},s.send(i)}))}},{key:"get",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.start("GET",t,null,n)}},{key:"post",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n instanceof URLSearchParams?(i["Content-Type"]="application/x-www-form-urlencoded",e.start("POST",t,n.toString(),i)):"object"===r(n)&&null!==n||Array.isArray(n)?(i["Content-Type"]="application/json",e.start("POST",t,JSON.stringify(n),i)):e.start("POST",t,n,i)}},{key:"delete",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.start("DELETE",t,null,n)}}],null&&o(t.prototype,null),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),s=function(e){return Intl.NumberFormat("en-US",{style:"currency",currency:e}).format},l=function(e){return new Date(1e3*e)},u=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Intl.DateTimeFormat().resolvedOptions(),a={dateStyle:"medium"};t&&(a.timeStyle="short");var r=Intl.DateTimeFormat(i.locale,a).format(e);return n&&(r="".concat(r," ").concat(i.timeZone)),r};function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t,n){return(t=b(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function k(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=v(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,r=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw r}}}}function v(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,b(i.key),i)}}function w(e,t,n){return t&&g(e.prototype,t),n&&g(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function b(e){var t=function(e,t){if("object"!==d(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!==d(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===d(t)?t:String(t)}function A(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}function S(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,B(e,t,"get"))}function E(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,B(e,t,"set"),n),n}function B(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var C="owns",I="buying",L="in-cart",P="none";document.addEventListener("beaconRunCheckout",(function(e){var t=e.checkoutProperties,n=t.products,i=t.productIds,r=s(t.currencyCode),o=new WeakMap,d=new WeakMap,h=new WeakMap,f=function(){function e(t){y(this,e),A(this,o,{writable:!0,value:null}),A(this,d,{writable:!0,value:{}}),A(this,h,{writable:!0,value:!1}),t?(E(this,o,t.id),E(this,d,t.products),E(this,h,t.isGift)):E(this,o,crypto.randomUUID?crypto.randomUUID():([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)})))}return w(e,[{key:"id",get:function(){return S(this,o)}},{key:"isGift",get:function(){return S(this,h)},set:function(e){E(this,h,e)}},{key:"productIds",get:function(){return Object.keys(S(this,d))}},{key:"count",get:function(){return Object.keys(S(this,d)).length}},{key:"reset",value:function(){E(this,d,{})}},{key:"add",value:function(e,t){this.setQuantity(e,this.getQuantity(e)+t)}},{key:"remove",value:function(e,t){this.setQuantity(e,this.getQuantity(e)-t)}},{key:"getQuantity",value:function(e){var t;return null!==(t=S(this,d)[e])&&void 0!==t?t:0}},{key:"setQuantity",value:function(e,t){t<=0?Object.prototype.hasOwnProperty.call(S(this,d),e)&&delete S(this,d)[e]:S(this,d)[e]=t}},{key:"toJSON",value:function(){return{id:S(this,o),products:S(this,d),isGift:S(this,h)}}},{key:"fingerprint",get:function(){var e=this,t=Object.keys(S(this,d)).sort().reduce((function(t,n){return t[n]=S(e,d)[n],t}),{});return btoa(JSON.stringify({id:S(this,o),products:t,isGift:S(this,h)}))}},{key:"hasArk",get:function(){var e;return this.getQuantity(null==n||null===(e=n.Ark)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)>0}},{key:"hasArkSA",get:function(){var e,t,i;return this.getQuantity(null==n||null===(e=n.ArkSA)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)>0||this.getQuantity(null==n||null===(t=n.ArkSA)||void 0===t||null===(t=t.Upgrade)||void 0===t?void 0:t.ProductId)>0||this.getQuantity(null==n||null===(i=n.ArkSA)||void 0===i||null===(i=i.Renewal)||void 0===i?void 0:i.ProductId)>0}},{key:"arkSAYears",get:function(){var e,t,i;return Math.min(this.getQuantity(null==n||null===(e=n.ArkSA)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)+this.getQuantity(null==n||null===(t=n.ArkSA)||void 0===t||null===(t=t.Upgrade)||void 0===t?void 0:t.ProductId)+this.getQuantity(null==n||null===(i=n.ArkSA)||void 0===i||null===(i=i.Renewal)||void 0===i?void 0:i.ProductId),10)}},{key:"hasMinimalGames",get:function(){var e,t;return this.getQuantity(null==n||null===(e=n.BeaconMinimal)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)>0||this.getQuantity(null==n||null===(t=n.BeaconMinimal)||void 0===t||null===(t=t.Renewal)||void 0===t?void 0:t.ProductId)>0}},{key:"minimalGamesYears",get:function(){var e,t;return Math.min(this.getQuantity(null==n||null===(e=n.BeaconMinimal)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)+this.getQuantity(null==n||null===(t=n.BeaconMinimal)||void 0===t||null===(t=t.Renewal)||void 0===t?void 0:t.ProductId),10)}},{key:"build",value:function(e,t,i,a,r){this.reset(),this.isGift=t,i&&(t||null===e.arkLicense)&&this.setQuantity(n.Ark.Base.ProductId,1),a>0&&(a=Math.min(a,5),t?(i?this.setQuantity(n.ArkSA.Upgrade.ProductId,1):this.setQuantity(n.ArkSA.Base.ProductId,1),a>1&&this.setQuantity(n.ArkSA.Renewal.ProductId,a-1)):null!==e.arkSALicense?this.setQuantity(n.ArkSA.Renewal.ProductId,a):(i||null!==e.arkLicense?this.setQuantity(n.ArkSA.Upgrade.ProductId,1):this.setQuantity(n.ArkSA.Base.ProductId,1),a>1&&this.setQuantity(n.ArkSA.Renewal.ProductId,a-1))),r>0&&(r=Math.min(r,5),t?(this.setQuantity(n.BeaconMinimal.Base.ProductId,1),r>1&&this.setQuantity(n.BeaconMinimal.Renewal.ProductId,r-1)):null!==e.minimalGamesLicense?this.setQuantity(n.BeaconMinimal.Renewal.ProductId,r):(this.setQuantity(n.BeaconMinimal.Base.ProductId,1),r>1&&this.setQuantity(n.BeaconMinimal.Renewal.ProductId,r-1)))}},{key:"rebuild",value:function(e){var t=this.fingerprint;return this.build(e,this.isGift,this.hasArk,this.arkSAYears,this.minimalGamesYears),this.fingerprint!==t}},{key:"consume",value:function(e,t){if(t){if(this.isGift!==t.isGift)throw new Error("Cannot merge a gift item with a non-gift item.");var n=this.hasArk||t.hasArk,i=this.arkSAYears+t.arkSAYears,a=this.hasMinimalGames||t.hasMinimalGames;this.build(e,this.isGift,n,i,a)}}},{key:"total",get:function(){var e,t=0,n=k(this.productIds);try{for(n.s();!(e=n.n()).done;){var a=e.value;t+=i[a].Price*this.getQuantity(a)}}catch(e){n.e(e)}finally{n.f()}return t}}]),e}(),g=new WeakMap,b=new WeakMap,B=new WeakMap,G=new WeakMap,x=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(y(this,e),A(this,g,{writable:!0,value:[]}),A(this,b,{writable:!0,value:null}),A(this,B,{writable:!0,value:!1}),A(this,G,{writable:!0,value:[]}),t)try{var n=JSON.parse(t);E(this,b,n.email),E(this,g,n.items.reduce((function(e,t){var n=new f(t);return n.count>0&&e.push(n),e}),[])),E(this,G,n.licenses)}catch(e){console.log("Failed to load saved cart")}}return w(e,[{key:"reset",value:function(){E(this,g,[]),E(this,b,null),E(this,B,!1),E(this,G,[]),this.save()}},{key:"toJSON",value:function(){return{email:S(this,b),items:S(this,g).reduce((function(e,t){return t.count>0&&e.push(t),e}),[]),licenses:S(this,G)}}},{key:"save",value:function(){localStorage.setItem("beaconCart",JSON.stringify(this))}},{key:"add",value:function(e){S(this,g).push(e),this.save()}},{key:"remove",value:function(e){E(this,g,S(this,g).filter((function(t){return t.id!==e.id}))),this.save()}},{key:"hasProduct",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=k(S(this,g));try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.getQuantity(e)>0&&a.isGift===n)return!0}}catch(e){i.e(e)}finally{i.f()}return!1}},{key:"email",get:function(){return S(this,b)}},{key:"setEmail",value:function(e){var t=this;return new Promise((function(i,a){var r=function(){var e,i=t.personalCartItem;return!!i&&(i.hasArk&&t.arkLicense?(i.setQuantity(null===(e=n.Ark)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId,0),0===i.count&&t.remove(i),!0):i.rebuild(t))};if(null===e){E(t,b,null),E(t,B,!1),E(t,G,[]);var o=r();return t.save(),void i({newEmail:null,cartChanged:o})}if(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).trim().toLowerCase())){var s=new URLSearchParams;s.append("email",e),c.get("/omni/lookup?".concat(s.toString())).then((function(n){var a=JSON.parse(n.body);E(t,b,a.email),E(t,B,a.verified),E(t,G,a.purchases);var o=r();t.save(),i({newEmail:e,cartChanged:o})})).catch((function(e){E(t,b,null),E(t,B,!1),E(t,G,[]),r(),t.save(),a(e.statusText)}))}else a("Address is not valid")}))}},{key:"emailVerified",get:function(){return S(this,B)}},{key:"checkingEmail",get:function(){return!1}},{key:"items",get:function(){return function(e){if(Array.isArray(e))return p(e)}(e=S(this,g))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||v(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();var e}},{key:"count",get:function(){return S(this,g).reduce((function(e,t){return t.count>0&&e++,e}),0)}},{key:"findLicense",value:function(e){var t,n=k(S(this,G));try{for(n.s();!(t=n.n()).done;){var i=t.value;if(i.productId===e)return i}}catch(e){n.e(e)}finally{n.f()}return null}},{key:"arkLicense",get:function(){var e;return this.findLicense(null==n||null===(e=n.Ark)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)}},{key:"arkSALicense",get:function(){var e;return this.findLicense(null==n||null===(e=n.ArkSA)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)}},{key:"minimalGamesLicense",get:function(){var e;return this.findLicense(null==n||null===(e=n.BeaconMinimal)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)}},{key:"ark2License",get:function(){return null}},{key:"personalCartItem",get:function(){var e,t=k(S(this,g));try{for(t.s();!(e=t.n()).done;){var n=e.value;if(!1===n.isGift)return n}}catch(e){t.e(e)}finally{t.f()}return null}},{key:"total",get:function(){var e,t=0,n=k(S(this,g));try{for(n.s();!(e=n.n()).done;)t+=e.value.total}catch(e){n.e(e)}finally{n.f()}return t}}],[{key:"load",value:function(){return new this(localStorage.getItem("beaconCart"))}}]),e}(),M=x.load(),T=new WeakMap,F=new WeakMap,D=function(){function e(t){y(this,e),A(this,T,{writable:!0,value:[]}),A(this,F,{writable:!0,value:null}),S(this,T).push(t)}return w(e,[{key:"currentView",get:function(){return S(this,T).slice(-1)}},{key:"back",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return!(S(this,T).length<=1||(this.switchView(S(this,T)[S(this,T).length-2],e),E(this,T,S(this,T).slice(0,S(this,T).length-2)),0))}},{key:"clearHistory",value:function(){S(this,T).length<=1||E(this,T,S(this,T).slice(-1))}},{key:"switchView",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.currentView!==e){S(this,F)&&(clearTimeout(S(this,F)),E(this,F,null));var i=document.getElementById(this.currentView),a=document.getElementById(e);S(this,T).push(e),n?(i.classList.add("invisible"),E(this,F,setTimeout((function(){i.classList.add("hidden"),a.classList.remove("hidden"),E(t,F,setTimeout((function(){a.classList.remove("invisible"),E(t,F,null)}),150))}),150))):(i.classList.add("hidden"),i.classList.add("invisible"),a.classList.remove("invisible"),a.classList.remove("hidden"))}}}]),e}();new D("checkout-wizard-start");var O=new D("page-landing"),N=document.getElementById("buy-button"),z=document.getElementById("cart-back-button"),R=1===Object.keys(i).length,j=function(){history.pushState({},"","/omni#checkout"),dispatchEvent(new PopStateEvent("popstate",{}))},Q={cancelButton:document.getElementById("checkout-email-cancel"),actionButton:document.getElementById("checkout-email-action"),emailField:document.getElementById("checkout-email-field"),errorField:document.getElementById("checkout-email-error"),allowsSkipping:!1,successFunction:function(e){},init:function(){var e=this,t=function(t){e.actionButton.disabled=!0,e.cancelButton.disabled=!0,e.errorField.classList.add("hidden"),M.setEmail(t).then((function(t){t.newEmail;var n=t.cartChanged;a.hideModal(),setTimeout((function(){e.successFunction(n)}),310)})).catch((function(t){e.errorField.innerText=t,e.errorField.classList.remove("hidden")})).finally((function(){e.actionButton.disabled=!1,e.cancelButton.disabled=!1}))};this.actionButton.addEventListener("click",(function(n){n.preventDefault(),t(e.emailField.value)})),this.cancelButton.addEventListener("click",(function(n){n.preventDefault(),e.allowsSkipping?t(null):a.hideModal()}))},present:function(e,n){t.forceEmail?M.setEmail(t.forceEmail).then((function(e){e.newEmail;var t=e.cartChanged;n(t)})):(this.allowsSkipping=e,this.successFunction=n,M.email?this.emailField.value=M.email:this.emailField.value=sessionStorage.getItem("email")||localStorage.getItem("email")||"",this.cancelButton.innerText=e?"Skip For Now":"Cancel",a.showModal("checkout-email"))}};Q.init();var U={cartView:null,editCartItem:null,actionButton:document.getElementById("checkout-wizard-action"),arkCheck:document.getElementById("checkout-wizard-ark-check"),arkOnlyCheck:document.getElementById("storefront-ark-check"),arkOnlyGiftDownButton:document.getElementById("storefront-ark-gift-decrease"),arkOnlyGiftField:document.getElementById("storefront-ark-gift-field"),arkOnlyGiftQuantityGroup:document.getElementById("storefront-ark-gift-group"),arkOnlyGiftUpButton:document.getElementById("storefront-ark-gift-increase"),arkOnlyOwnedField:document.getElementById("storefront-ark-owned"),arkPriceField:document.getElementById("checkout-wizard-ark-price"),arkSACheck:document.getElementById("checkout-wizard-arksa-check"),arkSADurationDownButton:document.getElementById("checkout-wizard-arksa-yeardown-button"),arkSADurationField:document.getElementById("checkout-wizard-arksa-duration-field"),arkSADurationGroup:document.getElementById("checkout-wizard-arksa-duration-group"),arkSADurationUpButton:document.getElementById("checkout-wizard-arksa-yearup-button"),arkSAPriceField:document.getElementById("checkout-wizard-arksa-full-price"),arkSAPromoField:document.getElementById("checkout-wizard-promo-arksa"),arkSAStatusField:document.getElementById("checkout-wizard-status-arksa"),arkSAUpgradePriceField:document.getElementById("checkout-wizard-arksa-discount-price"),arkStatusField:document.getElementById("checkout-wizard-status-ark"),giftCheck:document.getElementById("checkout-wizard-gift-check"),minimalGamesCheck:document.getElementById("checkout-wizard-beaconminimal-check"),minimalGamesDurationDownButton:document.getElementById("checkout-wizard-beaconminimal-yeardown-button"),minimalGamesDurationField:document.getElementById("checkout-wizard-beaconminimal-duration-field"),minimalGamesDurationGroup:document.getElementById("checkout-wizard-beaconminimal-duration-group"),minimalGamesDurationUpButton:document.getElementById("checkout-wizard-beaconminimal-yearup-button"),minimalGamesPriceField:document.getElementById("checkout-wizard-beaconminimal-price"),minimalGamesStatusField:document.getElementById("checkout-wizard-status-beaconminimal"),cancelButton:document.getElementById("checkout-wizard-cancel"),init:function(e){var t=this;if(this.cartView=e,this.cancelButton&&this.cancelButton.addEventListener("click",(function(e){e.preventDefault(),a.hideModal()})),this.actionButton&&this.actionButton.addEventListener("click",(function(e){e.preventDefault();var n=t.giftCheck.checked,i=t.arkCheck&&!1===t.arkCheck.disabled&&t.arkCheck.checked,r=t.arkSACheck&&!1===t.arkSACheck.disabled&&t.arkSACheck.checked,o=t.minimalGamesCheck&&!1===t.minimalGamesCheck.disabled&&t.minimalGamesCheck.checked;if(!1!==(i||r||o)){var c,s=r?parseInt(t.arkSADurationField.value)||1:0,l=o?parseInt(t.minimalGamesDurationField.value)||1:0;if(t.editCartItem?c=t.editCartItem:(c=new f).isGift=n,c.build(M,n,i,s,l),!1===Boolean(t.editCartItem)){var u=M.personalCartItem;!1===n&&!0===Boolean(u)?u.consume(M,c):M.add(c)}M.save(),t.cartView.update(),j(),a.hideModal()}})),this.giftCheck&&this.giftCheck.addEventListener("change",(function(){t.update()})),this.arkCheck&&this.arkCheck.addEventListener("change",(function(){t.update()})),this.arkSACheck&&this.arkSADurationField&&this.arkSADurationUpButton&&this.arkSADurationDownButton&&this.arkSADurationGroup){this.arkSACheck.addEventListener("change",(function(){t.update()})),this.arkSADurationField.addEventListener("input",(function(){t.update()}));var n=function(e){var n=parseInt(t.arkSADurationField.value),i=n+e;(i>5||i<1)&&(t.arkSADurationGroup.classList.add("shake"),setTimeout((function(){t.arkSADurationGroup.classList.remove("shake")}),400),i=Math.max(Math.min(i,5),1)),n!==i&&(t.arkSADurationField.value=i,t.arkSACheck.checked=!0,t.update())};this.arkSADurationUpButton.addEventListener("click",(function(e){e.preventDefault(),n(1)})),this.arkSADurationDownButton.addEventListener("click",(function(e){e.preventDefault(),n(-1)}))}if(this.minimalGamesCheck&&this.minimalGamesDurationField&&this.minimalGamesDurationUpButton&&this.minimalGamesDurationDownButton&&this.minimalGamesDurationGroup){this.minimalGamesCheck.addEventListener("change",(function(){t.update()})),this.minimalGamesDurationField.addEventListener("input",(function(){t.update()}));var i=function(e){var n=parseInt(t.minimalGamesDurationField.value),i=n+e;(i>5||i<1)&&(t.minimalGamesDurationGroup.classList.add("shake"),setTimeout((function(){t.minimalGamesDurationGroup.classList.remove("shake")}),400),i=Math.max(Math.min(i,5),1)),n!==i&&(t.minimalGamesDurationField.value=i,t.minimalGamesCheck.checked=!0,t.update())};this.minimalGamesDurationUpButton.addEventListener("click",(function(e){e.preventDefault(),i(1)})),this.minimalGamesDurationDownButton.addEventListener("click",(function(e){e.preventDefault(),i(-1)}))}if(this.arkOnlyCheck&&this.arkOnlyCheck.addEventListener("change",(function(e){if(e.preventDefault(),e.currentTarget.checked){var n=M.personalCartItem;n||(n=new f,M.add(n)),n.build(M,!1,!0,0),M.save()}else{var i=M.personalCartItem;i&&M.remove(i)}t.cartView.update()})),this.arkOnlyGiftField){var r=function(e){var n=M.items.filter((function(e){return!0===e.isGift&&e.hasArk}));if(n.length!==e){if(n.length>e)for(var i=e;i<=n.length-1;i++)M.remove(n[i]);else if(n.length<e)for(var a=n.length;a<e;a++){var r=new f;r.build(M,!0,!0,0),M.add(r)}t.cartView.update()}};this.arkOnlyGiftField.addEventListener("input",(function(e){var t=Math.min(Math.max(parseInt(e.currentTarget.value),0),5);r(t)})),this.arkOnlyGiftField.addEventListener("blur",(function(){t.cartView.update()}));var o=function(e){var n=parseInt(t.arkOnlyGiftField.value),i=n+e;(i>5||i<0)&&(t.arkOnlyGiftQuantityGroup.classList.add("shake"),setTimeout((function(){t.arkOnlyGiftQuantityGroup.classList.remove("shake")}),400),i=Math.max(Math.min(i,5),0)),n!==i&&(t.arkOnlyGiftField.value=i,r(i))};this.arkOnlyGiftUpButton.addEventListener("click",(function(e){e.preventDefault(),o(1)})),this.arkOnlyGiftDownButton.addEventListener("click",(function(e){e.preventDefault(),o(-1)}))}},present:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.editCartItem=e,this.arkCheck.disabled=!1,this.arkSACheck&&(this.arkSACheck.disabled=!1),this.minimalGamesCheck&&(this.minimalGamesCheck.disabled=!1),e?(this.giftCheck.checked=e.isGift,this.giftCheck.disabled=!0,this.arkCheck.checked=e.hasArk,this.arkSACheck&&(this.arkSACheck.checked=e.hasArkSA),this.minimalGamesCheck&&(this.minimalGamesCheck.checked=e.hasMinimalGames)):(this.giftCheck.checked=!1,this.giftCheck.disabled=!1,this.arkCheck.checked=!1,this.arkSACheck&&(this.arkSACheck.checked=!1),this.minimalGamesCheck&&(this.minimalGamesCheck.checked=!1)),this.arkSADurationField&&(this.arkSADurationField.value=e?e.arkSAYears:"1"),this.minimalGamesDurationField&&(this.minimalGamesDurationField.value=e?e.minimalGamesYears:"1"),this.cancelButton.innerText="Cancel",this.update(),a.showModal("checkout-wizard")},getGameStatus:function(){var e={Ark:P,ArkSA:P,BeaconMinimal:P},t=M.personalCartItem,n=Boolean(this.editCartItem);return this.giftCheck&&this.giftCheck.checked?(e.Ark=this.arkCheck&&!1===this.arkCheck.disabled&&this.arkCheck.checked?I:P,e.ArkSA=this.arkSACheck&&!1===this.arkSACheck.disabled&&this.arkSACheck.checked?I:P,e.BeaconMinimal=this.minimalGamesCheck=!1===this.minimalGamesCheck.disabled&&this.minimalGamesCheck.checked?I:P):(M.arkLicense?e.Ark=C:t&&(!1===n||t.id!==this.editCartItem.id)&&t.hasArk?e.Ark=L:this.arkCheck&&!1===this.arkCheck.disabled&&this.arkCheck.checked?e.Ark=I:e.Ark=P,M.arkSALicense?e.ArkSA=C:t&&(!1===n||t.id!==this.editCartItem.id)&&t.hasArkSA?e.ArkSA=L:this.arkSACheck&&this.arkSACheck&&!1===this.arkSACheck.disabled&&this.arkSACheck.checked?e.ArkSA=I:e.ArkSA=P,M.minimalGamesLicense?e.BeaconMinimal=C:t&&(!1===n||t.id!==this.editCartItem.id)&&t.hasMinimalGames()?e.BeaconMinimal=L:this.minimalGamesCheck&&this.minimalGamesCheck&&!1===this.minimalGamesCheck.disabled&&this.minimalGamesCheck.checked?e.BeaconMinimal=I:e.BeaconMinimal=P),e},update:function(){var e=this.getGameStatus(),t=0;if(this.arkCheck&&!1===this.arkCheck.disabled&&!0===this.arkCheck.checked&&(t+=n.Ark.Base.Price),this.arkSACheck){var i=n.ArkSA.Base.Price,a=n.ArkSA.Base.Price,o=Math.min(Math.max(parseInt(this.arkSADurationField.value)||1,1),5);parseInt(this.arkSADurationField.value)!==o&&document.activeElement!==this.arkSADurationField&&(this.arkSADurationField.value=o);var c=Math.max(o-1,0),s=Math.round((n.ArkSA.Base.Price-n.ArkSA.Upgrade.Price)/n.ArkSA.Base.Price*100);if(this.arkSAPromoField.innerText="".concat(s,"% off first year when bundled with ").concat(n.Ark.Base.Name),e.ArkSA===C){var d,h=M.arkSALicense,m=Math.floor(Date.now()/1e3),f=h.expiresEpoch,k=u(l(f),!1),v=(m>f?86400*Math.floor(m/86400)+86400:f)+n.ArkSA.Renewal.PlanLengthSeconds*o,p=u(l(v),!1);d=m>f?'Renew your update plan<br>Expired on <span class="text-red">'.concat(k,'</span><br>New expiration: <span class="text-green">').concat(p,"</span>"):'Extend your update plan<br>Expires on <span class="text-green">'.concat(k,'</span><br>New expiration: <span class="text-green">').concat(p,"</span>"),this.arkSAStatusField.innerHTML=d,a=i=n.ArkSA.Renewal.Price*o,this.arkSAPromoField.innerText="",this.arkSAPromoField.classList.add("hidden")}else if(e.ArkSA===L)a=i=n.ArkSA.Renewal.Price*o,this.arkSAStatusField.innerText="Additional renewal years for ".concat(n.ArkSA.Base.Name," in your cart."),this.arkSAPromoField.innerText="",this.arkSAPromoField.classList.add("hidden");else if(e.Ark!==P){i=n.ArkSA.Base.Price+n.ArkSA.Renewal.Price*c,a=n.ArkSA.Upgrade.Price+n.ArkSA.Renewal.Price*c;var y=e.Ark===C?"because you own":"when bundled with";this.arkSAStatusField.innerText="Includes first year of app updates. Additional years cost ".concat(r(n.ArkSA.Renewal.Price)," each."),this.arkSAPromoField.innerText="".concat(s,"% off first year ").concat(y," ").concat(n.Ark.Base.Name),this.arkSAPromoField.classList.remove("hidden")}else this.arkSAStatusField.innerText="Includes first year of app updates. Additional years cost ".concat(r(n.ArkSA.Renewal.Price)," each."),this.arkSAPromoField.innerText="".concat(s,"% off first year when bundled with ").concat(n.Ark.Base.Name),this.arkSAPromoField.classList.remove("hidden"),a=i=n.ArkSA.Base.Price+n.ArkSA.Renewal.Price*c;this.arkSAPriceField.classList.toggle("checkout-wizard-discounted",i!==a),this.arkSAPriceField.innerText=r(i),this.arkSAUpgradePriceField.classList.toggle("hidden",i===a),this.arkSAUpgradePriceField.innerText=r(a),!1===this.arkSACheck.disabled&&!0===this.arkSACheck.checked&&(t+=a)}if(e.Ark===C?(this.arkStatusField.innerText="You already own ".concat(n.Ark.Base.Name,"."),this.arkCheck.disabled=!0,this.arkCheck.checked=!1):e.Ark===L?(this.arkStatusField.innerText="".concat(n.Ark.Base.Name," is already in your cart."),this.arkCheck.disabled=!0,this.arkCheck.checked=!1):(this.arkStatusField.innerText="Includes lifetime app updates.",this.arkCheck.disabled=!1),this.minimalGamesCheck){var g=n.BeaconMinimal.Base.Price,w=Math.min(Math.max(parseInt(this.minimalGamesDurationField.value)||1,1),5);parseInt(this.minimalGamesDurationField.value)!==w&&document.activeElement!==this.minimalGamesDurationField&&(this.minimalGamesDurationField.value=w);var b=Math.max(w-1,0);if(e.BeaconMinimal===C){var A,S=M.minimalGamesLicense,E=Math.floor(Date.now()/1e3),B=S.expiresEpoch,I=u(l(B),!1),G=(E>B?86400*Math.floor(E/86400)+86400:B)+n.BeaconMinimal.Renewal.PlanLengthSeconds*w,x=u(l(G),!1);A=E>B?'Renew your update plan<br>Expired on <span class="text-red">'.concat(I,'</span><br>New expiration: <span class="text-green">').concat(x,"</span>"):'Extend your update plan<br>Expires on <span class="text-green">'.concat(I,'</span><br>New expiration: <span class="text-green">').concat(x,"</span>"),this.minimalGamesStatusField.innerHTML=A,g=n.BeaconMinimal.Renewal.Price*w}else e.BeaconMinimal===L?(g=n.BeaconMinimal.Renewal.Price*w,this.minimalGamesStatusField.innerText="Additional renewal years for ".concat(n.BeaconMinimal.Base.Name," in your cart.")):(this.minimalGamesStatusField.innerText="For games with only a few options, such as Palworld. Includes first year of app updates. Additional years cost ".concat(r(n.BeaconMinimal.Renewal.Price)," each."),g=n.BeaconMinimal.Base.Price+n.BeaconMinimal.Renewal.Price*b);this.minimalGamesPriceField.innerText=r(g),!1===this.minimalGamesCheck.disabled&&!0===this.minimalGamesCheck.checked&&(t+=g)}var T=this.editCartItem?"Edit":"Add to Cart";t>0?(this.actionButton.disabled=!1,this.actionButton.innerText="".concat(T,": ").concat(r(t))):(this.actionButton.disabled=!0,this.actionButton.innerText=T)}},H={wizard:null,emailField:document.getElementById("storefront-cart-header-email-field"),changeEmailButton:document.getElementById("storefront-cart-header-email-button"),currencyMenu:document.getElementById("storefront-cart-currency-menu"),addMoreButton:document.getElementById("storefront-cart-more-button"),checkoutButton:document.getElementById("storefront-cart-checkout-button"),refundCheckbox:document.getElementById("storefront-refund-checkbox"),footer:document.getElementById("storefront-cart-footer"),body:document.getElementById("storefront-cart"),totalField:document.getElementById("storefront-cart-total"),init:function(e){var t=this;this.wizard=e,this.currencyMenu.addEventListener("change",(function(e){e.preventDefault(),c.get("/omni/currency?currency=".concat(e.target.value)).then((function(){window.location.reload()})).catch((function(e){console.log(JSON.stringify(e)),a.show("Currency was not changed",e.statusText)}))})),this.addMoreButton.addEventListener("click",(function(e){e.preventDefault(),t.wizard.present()})),this.checkoutButton.addEventListener("click",(function(e){e.preventDefault();var n=t.refundCheckbox.checked,i=function(e){t.update(),e?M.count>0?a.show("Your cart contents have changed.","The items in your cart have changed based on your e-mail address. Please review before continuing checkout."):a.show("Your cart is now empty.","You already own everything in your cart. There is no need to purchase again."):(t.checkoutButton.disabled=!0,c.post("/omni/begin",m(m({},M.toJSON()),{},{refundPolicyAgreed:n})).then((function(e){try{var t=JSON.parse(e.body),n=t.url;sessionStorage.setItem("clientReferenceId",t.client_reference_id),window.location=n}catch(t){console.log(e.body),a.show("Unknown Error","There was an unknown error while starting the checkout process.")}})).catch((function(e){try{var t=JSON.parse(e.body).message;a.show("Checkout Error",t)}catch(t){console.log(e.body),a.show("Unknown Error","There was an unknown error while starting the checkout process.")}})).finally((function(){t.checkoutButton.disabled=!1})))};M.email?n?i(!1):a.show("Hang on","Please agree to the refund policy."):Q.present(!1,i)})),this.changeEmailButton.addEventListener("click",(function(e){e.preventDefault(),Q.present(!1,(function(){t.update()}))})),this.update()},update:function(){var e,n=this;if(R){this.emailField.innerText=M.email,this.changeEmailButton.disabled=Boolean(t.forceEmail),this.changeEmailButton.innerText=M.email?"Change Email":"Set Email",this.changeEmailButton.classList.remove("hidden"),this.addMoreButton.classList.add("hidden"),M.arkLicense?(this.wizard.arkOnlyOwnedField.classList.remove("hidden"),this.wizard.arkOnlyCheck.parentElement.classList.add("hidden")):(this.wizard.arkOnlyOwnedField.classList.add("hidden"),this.wizard.arkOnlyCheck.parentElement.classList.remove("hidden"));var i=M.personalCartItem;if(this.wizard.arkOnlyCheck.checked=i&&i.hasArk,document.activeElement!==this.wizard.arkOnlyGiftField){var a=M.items.filter((function(e){return!0===e.isGift&&e.hasArk}));this.wizard.arkOnlyGiftField.value=a.length}}else if(M.count>0)this.emailField.innerText=M.email,this.changeEmailButton.disabled=Boolean(t.forceEmail),this.changeEmailButton.innerText=M.email?"Change Email":"Set Email",this.changeEmailButton.classList.remove("hidden"),this.body.innerText="",this.body.classList.remove("empty"),this.footer.classList.remove("hidden"),M.items.forEach((function(e){var t=n.createCartItemRow(e);t&&n.body.appendChild(t)})),N.innerText="Go to Cart";else{this.emailField.innerText="",this.changeEmailButton.classList.add("hidden"),this.body.innerText="",this.body.classList.add("empty"),this.footer.classList.add("hidden"),this.body.appendChild(document.createElement("div"));var r=document.createElement("div"),o=document.createElement("p");o.appendChild(document.createTextNode("Your cart is empty.")),r.appendChild(o),this.buyMoreButton=document.createElement("button"),this.buyMoreButton.addEventListener("click",(function(){Q.present(!0,(function(){n.wizard.present()}))})),this.buyMoreButton.classList.add("default"),this.buyMoreButton.appendChild(document.createTextNode("Buy Omni"));var c=document.createElement("p");c.appendChild(this.buyMoreButton),r.appendChild(c),this.body.appendChild(r),this.body.appendChild(document.createElement("div")),N.innerText="Buy Omni"}this.totalField.setAttribute("beacon-price",M.total),e=t.currencyCode,document.querySelectorAll(".formatted-price").forEach((function(t){var n,i=parseFloat(null!==(n=t.getAttribute("beacon-price"))&&void 0!==n?n:t.innerText),a=t.getAttribute("beacon-currency"),r=s(null!=a?a:e);r&&(t.innerText=r(i))})),this.checkoutButton.disabled=0===M.total},createProductRow:function(e,t){var n=e.getQuantity(t);if(n<=0)return null;var a=i[t].Name,r=i[t].Price,o=document.createElement("div");o.appendChild(document.createTextNode(n));var c=document.createElement("div");c.appendChild(document.createTextNode(a));var s=document.createElement("div");s.classList.add("formatted-price"),s.appendChild(document.createTextNode(r*n));var l=document.createElement("div");return l.classList.add("bundle-product"),l.appendChild(o),l.appendChild(c),l.appendChild(s),l},createCartItemRow:function(e){var t=this,n=e.productIds;if(n.length<=0)return null;var i=document.createElement("div");i.classList.add("bundle"),n.forEach((function(n){var a=t.createProductRow(e,n);a&&i.appendChild(a)}));var a=document.createElement("div");e.isGift&&(i.classList.add("gift"),a.classList.add("gift"),n.length>1?a.appendChild(document.createTextNode("These products are a gift. You will receive a gift code for them.")):a.appendChild(document.createTextNode("This product is a gift. You will receive a gift code for it.")));var r=document.createElement("button");r.appendChild(document.createTextNode("Edit")),r.classList.add("small"),r.addEventListener("click",(function(n){n.preventDefault(),t.wizard.present(e)}));var o=document.createElement("button");o.appendChild(document.createTextNode("Remove")),o.classList.add("red"),o.classList.add("small"),o.addEventListener("click",(function(n){n.preventDefault(),M.remove(e),t.update()}));var c=document.createElement("div");c.classList.add("button-group"),c.appendChild(r),c.appendChild(o);var s=document.createElement("div");s.appendChild(c);var l=document.createElement("div");return l.classList.add("actions"),l.classList.add("double-group"),l.appendChild(a),l.appendChild(s),i.appendChild(l),i}};U.init(H),H.init(U);var Y=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];window.scrollTo(window.scrollX,0),"#checkout"===window.location.hash?O.switchView("page-cart",e):O.back(e)};N.addEventListener("click",(function(e){e.preventDefault(),R||M.count>0?j():Q.present(!0,(function(){U.present()}))})),z.addEventListener("click",(function(){history.pushState({},"","/omni"),dispatchEvent(new PopStateEvent("popstate",{}))})),window.addEventListener("popstate",(function(){Y(!0)})),Y(!1),t.forceEmail&&(M.email!==t.forceEmail&&M.reset(),0===M.count?Q.present(!0,(function(){U.present()})):j())}))})();