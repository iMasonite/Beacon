(()=>{"use strict";var e;function t(e,t,i){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class i{static show(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Ok";return this.confirm(e,t,i,null)}static confirm(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Ok",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Cancel",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return new Promise(((r,s)=>{const o=document.getElementById("overlay"),c=document.getElementById("dialog"),l=document.getElementById("dialog_message"),d=document.getElementById("dialog_explanation"),u=document.getElementById("dialog_slot"),h=document.getElementById("dialog_action_button"),m=document.getElementById("dialog_cancel_button");o&&c&&l&&d&&h&&m?(o.className="exist",c.className="exist",setTimeout((()=>{o.className="exist visible",c.className="exist visible"}),10),l.innerText=e,t?(d.innerText=t,d.classList.remove("hidden")):(d.innerText="",d.classList.add("hidden")),u&&(a?(u.innerHTML=a,u.classList.remove("hidden")):(u.innerText="",u.classList.add("hidden"))),h.clickHandler&&h.removeEventListener("click",h.clickHandler),m.clickHandler&&m.removeEventListener("click",m.clickHandler),h.clickHandler=()=>{this.hide(),setTimeout((()=>{r()}),300)},h.addEventListener("click",h.clickHandler),h.innerText=i,n?(m.clickHandler=()=>{this.hide(),setTimeout((()=>{s()}),300)},m.addEventListener("click",m.clickHandler),m.innerText=n):m.className="hidden"):s()}))}static hide(){var e=document.getElementById("overlay"),t=document.getElementById("dialog");e&&t&&(e.className="exist",t.className="exist",setTimeout((()=>{e.className="",t.className=""}),300))}static showModal(e){if(this.activeModal)return;const t=document.getElementById("overlay"),i=document.getElementById(e);t&&i&&(t.classList.add("exist"),i.classList.add("exist"),this.activeModal=e,setTimeout((()=>{t.classList.add("visible"),i.classList.add("visible")}),10),this.viewportWatcher=setInterval((()=>{if(!this.activeModal)return;document.querySelectorAll("#".concat(this.activeModal," .modal-content .content")).forEach((e=>{i.classList.toggle("scrolled",e.scrollHeight>e.clientHeight)}));const e=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0);i.classList.toggle("centered",i.clientHeight>.75*e)}),100))}static hideModal(){return new Promise(((e,t)=>{if(!this.activeModal)return void t();const i=document.getElementById("overlay"),n=document.getElementById(this.activeModal);i&&n?(this.viewportWatcher&&(clearInterval(this.viewportWatcher),this.viewportWatcher=null),i.classList.remove("visible"),n.classList.remove("visible"),setTimeout((()=>{i.classList.remove("exist"),n.classList.remove("exist"),this.activeModal=null,e()}),300)):t()}))}}e=i,t(i,"activeModal",null),t(i,"viewportWatcher",null),t(i,"secureConfirm",(function(t,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Ok",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Cancel";return new Promise(((s,o)=>{let c;switch(t){case"password":c=e.confirm(i,n,a,r,'<div class="floating-label"><input type="password" class="text-field" id="dialog_confirm_field" placeholder="Account Password"><label for="dialog_confirm_field">Account Password</label></div>');break;case"anyAuthenticator":c=e.confirm(i,n,a,r,'<div class="floating-label"><input type="text" class="text-field" id="dialog_confirm_field" placeholder="Two Step Code"><label for="dialog_confirm_field">Two Step Code</label></div>');break;default:console.log("Unknown security option ".concat(t)),o("Unknown security option")}c.then((()=>{const e=document.getElementById("dialog_confirm_field");s(e.value)})).catch((()=>{o()}))}))}));class n{static prepareResponse(e){return{xhr:e,status:e.status,statusText:e.statusText,body:e.responseText,success:e.status>=200&&e.status<300||304===e.status}}static start(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new Promise(((a,r)=>{const s=new XMLHttpRequest;if(s.open(e,t,!0),"object"==typeof n&&null!==n&&!1===Array.isArray(n)){const e=Object.keys(n);for(const t of e)s.setRequestHeader(t,n[t])}s.onload=()=>{const e=this.prepareResponse(s);e.success?a(e):r(e)},s.onerror=()=>{r(this.prepareResponse(s))},s.send(i)}))}static get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n.start("GET",e,null,t)}static post(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t instanceof URLSearchParams?(i["Content-Type"]="application/x-www-form-urlencoded",n.start("POST",e,t.toString(),i)):"object"==typeof t&&null!==t||Array.isArray(t)?(i["Content-Type"]="application/json",n.start("POST",e,JSON.stringify(t),i)):n.start("POST",e,t,i)}static delete(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n.start("DELETE",e,null,t)}}function a(e,t,i){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class r{constructor(e){a(this,"element",null),a(this,"pageMap",{}),a(this,"currentPageName",null),a(this,"currentPageTitle",null),this.element=e;const t=e.querySelectorAll("div.page-panel-page");for(const e of t){const t=e.getAttribute("page");this.pageMap[t]=e,e.classList.contains("page-panel-visible")&&(this.currentPageName=t)}const i=e.querySelectorAll("div.page-panel-nav a");for(const e of i){const t=e.getAttribute("page");this.pageMap[t]&&(this.pageMap[t].link=e,e.addEventListener("click",(e=>{e.preventDefault(),this.switchPage(e.target.getAttribute("page"))})))}const n=new Event("panelCreated");n.panel=this,this.element.dispatchEvent(n)}switchPage(e){const t=this.currentPageName;if(t===e)return;if(!this.pageMap[e])return;this.pageMap[t].classList.remove("page-panel-visible"),this.pageMap[t].link.parentElement.classList.remove("page-panel-active"),this.pageMap[e].classList.add("page-panel-visible"),this.pageMap[e].link.parentElement.classList.add("page-panel-active"),this.currentPageName=e,this.currentPageTitle=this.pageMap[e].link.innerText;const i=new Event("panelSwitched");i.panel=this,this.element.dispatchEvent(i)}hasPage(e){return Object.hasOwn?Object.hasOwn(this.pageMap,e):Object.prototype.hasOwnProperty.call(this.pageMap,e)}static init(){const e=document.querySelectorAll("div.page-panel");for(const t of e)r.pagePanels[t.id]=new r(t)}}a(r,"pagePanels",{});const s=e=>Intl.NumberFormat("en-US",{style:"currency",currency:e}).format,o=e=>new Date(1e3*e),c=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=Intl.DateTimeFormat().resolvedOptions(),a={dateStyle:"medium"};t&&(a.timeStyle="short");let r=Intl.DateTimeFormat(n.locale,a).format(e);return i&&(r="".concat(r," ").concat(n.timeZone)),r};function l(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function d(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?l(Object(i),!0).forEach((function(t){u(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function u(e,t,i){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function h(e,t,i){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,i)}function m(e,t){return e.get(p(e,t))}function k(e,t,i){return e.set(p(e,t),i),i}function p(e,t,i){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:i;throw new TypeError("Private element is not present on this object")}const g="owns",v="buying",f="in-cart",y="none";document.addEventListener("beaconRunCheckout",(e=>{let{checkoutProperties:t}=e;const a=t.products,l=t.productIds,u=s(t.currencyCode),p=t.games,w=p.filter((e=>"Ark"!==e.gameId&&"ArkSA"!==e.gameId));r.init();const A=r.pagePanels["panel-games"];A&&A.element.addEventListener("panelSwitched",(()=>{A.currentPageTitle?document.title="Beacon Omni for ".concat(A.currentPageTitle):document.title="Beacon Omni",history.pushState({},"","/omni#".concat(A.currentPageName))}));var S=new WeakMap,b=new WeakMap,E=new WeakMap;class C{constructor(e){h(this,S,null),h(this,b,{}),h(this,E,!1),e?(k(S,this,e.id),k(b,this,e.products),k(E,this,e.isGift)):k(S,this,crypto.randomUUID?crypto.randomUUID():([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))))}get id(){return m(S,this)}get isGift(){return m(E,this)}set isGift(e){k(E,this,e)}get productIds(){return Object.keys(m(b,this))}get count(){return Object.keys(m(b,this)).length}reset(){k(b,this,{})}add(e,t){this.setQuantity(e,this.getQuantity(e)+t)}remove(e,t){this.setQuantity(e,this.getQuantity(e)-t)}getQuantity(e){var t;return null!==(t=m(b,this)[e])&&void 0!==t?t:0}setQuantity(e,t){t<=0?Object.prototype.hasOwnProperty.call(m(b,this),e)&&delete m(b,this)[e]:m(b,this)[e]=t}toJSON(){return{id:m(S,this),products:m(b,this),isGift:m(E,this)}}get fingerprint(){const e=Object.keys(m(b,this)).sort().reduce(((e,t)=>(e[t]=m(b,this)[t],e)),{});return btoa(JSON.stringify({id:m(S,this),products:e,isGift:m(E,this)}))}get hasArk(){var e;return this.getQuantity(null==a||null===(e=a.Ark)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)>0}get hasArkSA(){var e,t,i;return this.getQuantity(null==a||null===(e=a.ArkSA)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)>0||this.getQuantity(null==a||null===(t=a.ArkSA)||void 0===t||null===(t=t.Upgrade)||void 0===t?void 0:t.ProductId)>0||this.getQuantity(null==a||null===(i=a.ArkSA)||void 0===i||null===(i=i.Renewal)||void 0===i?void 0:i.ProductId)>0}get arkSAYears(){var e,t,i;return Math.min(this.getQuantity(null==a||null===(e=a.ArkSA)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)+this.getQuantity(null==a||null===(t=a.ArkSA)||void 0===t||null===(t=t.Upgrade)||void 0===t?void 0:t.ProductId)+this.getQuantity(null==a||null===(i=a.ArkSA)||void 0===i||null===(i=i.Renewal)||void 0===i?void 0:i.ProductId),5)}hasGame(e){var t,i;return"ArkSA"===e?this.hasArkSA:this.getQuantity(null==a||null===(t=a[e])||void 0===t||null===(t=t.Base)||void 0===t?void 0:t.ProductId)>0||this.getQuantity(null==a||null===(i=a[e])||void 0===i||null===(i=i.Renewal)||void 0===i?void 0:i.ProductId)>0}yearsForGame(e){var t,i;return"ArkSA"===e?this.arkSAYears:Math.min(this.getQuantity(null==a||null===(t=a[e])||void 0===t||null===(t=t.Base)||void 0===t?void 0:t.ProductId)+this.getQuantity(null==a||null===(i=a[e])||void 0===i||null===(i=i.Renewal)||void 0===i?void 0:i.ProductId),5)}yearsForOtherGames(){const e={};for(const t of w)this.yearsForGame(t.gameId)>0&&(e[t.gameId]=this.yearsForGame(t.gameId));return e}build(e,t,i,n,r){if(this.reset(),this.isGift=t,i&&(t||null===e.arkLicense)&&this.setQuantity(a.Ark.Base.ProductId,1),n>0&&(n=Math.min(n,5),t?(i?this.setQuantity(a.ArkSA.Upgrade.ProductId,1):this.setQuantity(a.ArkSA.Base.ProductId,1),n>1&&this.setQuantity(a.ArkSA.Renewal.ProductId,n-1)):null!==e.arkSALicense?this.setQuantity(a.ArkSA.Renewal.ProductId,n):(i||null!==e.arkLicense?this.setQuantity(a.ArkSA.Upgrade.ProductId,1):this.setQuantity(a.ArkSA.Base.ProductId,1),n>1&&this.setQuantity(a.ArkSA.Renewal.ProductId,n-1))),r)for(const i of w){var s;const n=Math.min(null!==(s=r[i.gameId])&&void 0!==s?s:0,5);0!==n&&(!1===t&&null!==e.findLicense(a[i.gameId].Base.ProductId)?this.setQuantity(a[i.gameId].Renewal.ProductId,n):(this.setQuantity(a[i.gameId].Base.ProductId,1),n>1&&this.setQuantity(a[i.gameId].Renewal.ProductId,n-1)))}}rebuild(e){const t=this.fingerprint;return this.build(e,this.isGift,this.hasArk,this.arkSAYears,this.yearsForOtherGames()),this.fingerprint!==t}consume(e,t){if(!t)return;if(this.isGift!==t.isGift)throw new Error("Cannot merge a gift item with a non-gift item.");const i=this.hasArk||t.hasArk,n=this.arkSAYears+t.arkSAYears,a=this.yearsForOtherGames(),r=t.yearsForOtherGames();for(const[e,t]of Object.entries(r)){var s;a[e]=(null!==(s=a[e])&&void 0!==s?s:0)+t}this.build(e,this.isGift,i,n,a)}get total(){const e=this.productIds;let t=0;for(const i of e)t+=l[i].Price*this.getQuantity(i);return t}}var I=new WeakMap,B=new WeakMap,L=new WeakMap,P=new WeakMap;const x=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(h(this,I,[]),h(this,B,null),h(this,L,!1),h(this,P,[]),e)try{const t=JSON.parse(e);k(B,this,t.email),k(I,this,t.items.reduce(((e,t)=>{const i=new C(t);return i.count>0&&e.push(i),e}),[])),k(P,this,t.licenses)}catch(e){console.log("Failed to load saved cart")}}reset(){k(I,this,[]),k(B,this,null),k(L,this,!1),k(P,this,[]),this.save()}toJSON(){return{email:m(B,this),items:m(I,this).reduce(((e,t)=>(t.count>0&&e.push(t),e)),[]),licenses:m(P,this)}}save(){localStorage.setItem("beaconCart",JSON.stringify(this))}static load(){return new this(localStorage.getItem("beaconCart"))}add(e){m(I,this).push(e),this.save()}remove(e){k(I,this,m(I,this).filter((t=>t.id!==e.id))),this.save()}hasProduct(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(const i of m(I,this))if(i.getQuantity(e)>0&&i.isGift===t)return!0;return!1}get email(){return m(B,this)}setEmail(e){return new Promise(((t,i)=>{const r=()=>{const e=this.personalCartItem;return!!e&&(e.hasArk&&this.arkLicense?(e.setQuantity(null===(t=a.Ark)||void 0===t||null===(t=t.Base)||void 0===t?void 0:t.ProductId,0),0===e.count&&this.remove(e),!0):e.rebuild(this));var t};if(null===e){k(B,this,null),k(L,this,!1),k(P,this,[]);const e=r();return this.save(),void t({newEmail:null,cartChanged:e})}if(!/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).trim().toLowerCase()))return void i("Address is not valid");const s=new URLSearchParams;s.append("email",e),n.get("/omni/lookup?".concat(s.toString())).then((i=>{const n=JSON.parse(i.body);k(B,this,n.email),k(L,this,n.verified),k(P,this,n.purchases);const a=r();this.save(),t({newEmail:e,cartChanged:a})})).catch((e=>{k(B,this,null),k(L,this,!1),k(P,this,[]),r(),this.save(),i(e.statusText)}))}))}get emailVerified(){return m(L,this)}get checkingEmail(){return!1}get items(){return[...m(I,this)]}get count(){return m(I,this).reduce(((e,t)=>(t.count>0&&e++,e)),0)}findLicense(e){for(const t of m(P,this))if(t.productId===e)return t;return null}get arkLicense(){var e;return this.findLicense(null==a||null===(e=a.Ark)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)}get arkSALicense(){var e;return this.findLicense(null==a||null===(e=a.ArkSA)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)}get ark2License(){return null}get personalCartItem(){for(const e of m(I,this))if(!1===e.isGift)return e;return null}get total(){let e=0;for(const t of m(I,this))e+=t.total;return e}}.load();var T=new WeakMap,F=new WeakMap;class O{constructor(e){h(this,T,[]),h(this,F,null),m(T,this).push(e)}get currentView(){return m(T,this).slice(-1)}back(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return!(m(T,this).length<=1||(this.switchView(m(T,this)[m(T,this).length-2],e),k(T,this,m(T,this).slice(0,m(T,this).length-2)),0))}clearHistory(){m(T,this).length<=1||k(T,this,m(T,this).slice(-1))}switchView(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.currentView===e)return;m(F,this)&&(clearTimeout(m(F,this)),k(F,this,null));const i=document.getElementById(this.currentView),n=document.getElementById(e);m(T,this).push(e),t?(i.classList.add("invisible"),k(F,this,setTimeout((()=>{i.classList.add("hidden"),n.classList.remove("hidden"),k(F,this,setTimeout((()=>{n.classList.remove("invisible"),k(F,this,null)}),150))}),150))):(i.classList.add("hidden"),i.classList.add("invisible"),n.classList.remove("invisible"),n.classList.remove("hidden"))}}new O("checkout-wizard-start");const M=new O("page-landing"),D=document.getElementById("buy-button"),G=document.getElementById("cart-back-button"),N=()=>{document.title="Buy Beacon Omni",history.pushState({},"","/omni#checkout"),dispatchEvent(new PopStateEvent("popstate",{}))},R={cancelButton:document.getElementById("checkout-email-cancel"),actionButton:document.getElementById("checkout-email-action"),emailField:document.getElementById("checkout-email-field"),errorField:document.getElementById("checkout-email-error"),allowsSkipping:!1,successFunction:function(e){},init:function(){const e=e=>{this.actionButton.disabled=!0,this.cancelButton.disabled=!0,this.errorField.classList.add("hidden"),x.setEmail(e).then((e=>{let{newEmail:t,cartChanged:n}=e;i.hideModal(),setTimeout((()=>{this.successFunction(n)}),310)})).catch((e=>{this.errorField.innerText=e,this.errorField.classList.remove("hidden")})).finally((()=>{this.actionButton.disabled=!1,this.cancelButton.disabled=!1}))};this.actionButton.addEventListener("click",(t=>{t.preventDefault(),e(this.emailField.value)})),this.cancelButton.addEventListener("click",(t=>{t.preventDefault(),this.allowsSkipping?e(null):i.hideModal()}))},present:function(e,n){t.forceEmail?x.setEmail(t.forceEmail).then((e=>{let{newEmail:t,cartChanged:i}=e;n(i)})):(this.allowsSkipping=e,this.successFunction=n,x.email?this.emailField.value=x.email:this.emailField.value=sessionStorage.getItem("email")||localStorage.getItem("email")||"",this.cancelButton.innerText=e?"Skip For Now":"Cancel",i.showModal("checkout-email"))}};R.init();const Q={cartView:null,editCartItem:null,actionButton:document.getElementById("checkout-wizard-action"),arkCheck:document.getElementById("checkout-wizard-ark-check"),arkOnlyCheck:document.getElementById("storefront-ark-check"),arkOnlyGiftDownButton:document.getElementById("storefront-ark-gift-decrease"),arkOnlyGiftField:document.getElementById("storefront-ark-gift-field"),arkOnlyGiftQuantityGroup:document.getElementById("storefront-ark-gift-group"),arkOnlyGiftUpButton:document.getElementById("storefront-ark-gift-increase"),arkOnlyOwnedField:document.getElementById("storefront-ark-owned"),arkPriceField:document.getElementById("checkout-wizard-ark-price"),arkSACheck:document.getElementById("checkout-wizard-arksa-check"),arkSADurationDownButton:document.getElementById("checkout-wizard-arksa-yeardown-button"),arkSADurationField:document.getElementById("checkout-wizard-arksa-duration-field"),arkSADurationGroup:document.getElementById("checkout-wizard-arksa-duration-group"),arkSADurationUpButton:document.getElementById("checkout-wizard-arksa-yearup-button"),arkSAPriceField:document.getElementById("checkout-wizard-arksa-full-price"),arkSAPromoField:document.getElementById("checkout-wizard-promo-arksa"),arkSAStatusField:document.getElementById("checkout-wizard-status-arksa"),arkSAUpgradePriceField:document.getElementById("checkout-wizard-arksa-discount-price"),arkStatusField:document.getElementById("checkout-wizard-status-ark"),giftCheck:document.getElementById("checkout-wizard-gift-check"),cancelButton:document.getElementById("checkout-wizard-cancel"),init:function(e){this.cartView=e;for(const e of w){const t=e.gameId.toLowerCase();this["".concat(t,"Check")]=document.getElementById("checkout-wizard-".concat(t,"-check")),this["".concat(t,"DurationDownButton")]=document.getElementById("checkout-wizard-".concat(t,"-yeardown-button")),this["".concat(t,"DurationField")]=document.getElementById("checkout-wizard-".concat(t,"-duration-field")),this["".concat(t,"DurationGroup")]=document.getElementById("checkout-wizard-".concat(t,"-duration-group")),this["".concat(t,"DurationUpButton")]=document.getElementById("checkout-wizard-".concat(t,"-yearup-button")),this["".concat(t,"PriceField")]=document.getElementById("checkout-wizard-".concat(t,"-price")),this["".concat(t,"StatusField")]=document.getElementById("checkout-wizard-status-".concat(t))}if(this.cancelButton&&this.cancelButton.addEventListener("click",(e=>{e.preventDefault(),i.hideModal()})),this.actionButton&&this.actionButton.addEventListener("click",(e=>{e.preventDefault();const t=this.giftCheck.checked,n=this.arkCheck&&!1===this.arkCheck.disabled&&this.arkCheck.checked,a=this.arkSACheck&&!1===this.arkSACheck.disabled&&this.arkSACheck.checked;let r=!1;const s={};for(const e of w){const t=e.gameId,i=t.toLowerCase();this["".concat(i,"Check")]&&!1===this["".concat(i,"Check")].disabled&&this["".concat(i,"Check")].checked&&(r=!0,s[t]=parseInt(this["".concat(i,"DurationField")].value)||1)}if(!1===(n||a||r))return;const o=a?parseInt(this.arkSADurationField.value)||1:0;let c;if(this.editCartItem?c=this.editCartItem:(c=new C,c.isGift=t),c.build(x,t,n,o,s),!1===Boolean(this.editCartItem)){const e=x.personalCartItem;!1===t&&!0===Boolean(e)?e.consume(x,c):x.add(c)}x.save(),this.cartView.update(),N(),i.hideModal()})),this.giftCheck&&this.giftCheck.addEventListener("change",(()=>{this.update()})),this.arkCheck&&this.arkCheck.addEventListener("change",(()=>{this.update()})),this.arkSACheck&&this.arkSADurationField&&this.arkSADurationUpButton&&this.arkSADurationDownButton&&this.arkSADurationGroup){this.arkSACheck.addEventListener("change",(()=>{this.update()})),this.arkSADurationField.addEventListener("input",(()=>{this.update()}));const e=e=>{const t=parseInt(this.arkSADurationField.value);let i=t+e;(i>5||i<1)&&(this.arkSADurationGroup.classList.add("shake"),setTimeout((()=>{this.arkSADurationGroup.classList.remove("shake")}),400),i=Math.max(Math.min(i,5),1)),t!==i&&(this.arkSADurationField.value=i,this.arkSACheck.checked=!0,this.update())};this.arkSADurationUpButton.addEventListener("click",(t=>{t.preventDefault(),e(1)})),this.arkSADurationDownButton.addEventListener("click",(t=>{t.preventDefault(),e(-1)}))}for(const e of w){const t=e.gameId.toLowerCase(),i=this["".concat(t,"Check")],n=this["".concat(t,"DurationField")],a=this["".concat(t,"DurationUpButton")],r=this["".concat(t,"DurationDownButton")],s=this["".concat(t,"DurationGroup")];if(i&&n&&a&&r&&s){i.addEventListener("change",(()=>{this.update()})),n.addEventListener("input",(()=>{this.update()}));const e=e=>{const t=parseInt(n.value);let a=t+e;(a>5||a<1)&&(s.classList.add("shake"),setTimeout((()=>{s.classList.remove("shake")}),400),a=Math.max(Math.min(a,5),1)),t!==a&&(n.value=a,i.checked=!0,this.update())};a.addEventListener("click",(t=>{t.preventDefault(),e(1)})),r.addEventListener("click",(t=>{t.preventDefault(),e(-1)}))}}if(this.arkOnlyCheck&&this.arkOnlyCheck.addEventListener("change",(e=>{if(e.preventDefault(),e.currentTarget.checked){let e=x.personalCartItem;e||(e=new C,x.add(e)),e.build(x,!1,!0,0),x.save()}else{const e=x.personalCartItem;e&&x.remove(e)}this.cartView.update()})),this.arkOnlyGiftField){const e=e=>{const t=x.items.filter((e=>!0===e.isGift&&e.hasArk));if(t.length!==e){if(t.length>e)for(let i=e;i<=t.length-1;i++)x.remove(t[i]);else if(t.length<e)for(let i=t.length;i<e;i++){const e=new C;e.build(x,!0,!0,0),x.add(e)}this.cartView.update()}};this.arkOnlyGiftField.addEventListener("input",(t=>{const i=Math.min(Math.max(parseInt(t.currentTarget.value),0),5);e(i)})),this.arkOnlyGiftField.addEventListener("blur",(()=>{this.cartView.update()}));const t=t=>{const i=parseInt(this.arkOnlyGiftField.value);let n=i+t;(n>5||n<0)&&(this.arkOnlyGiftQuantityGroup.classList.add("shake"),setTimeout((()=>{this.arkOnlyGiftQuantityGroup.classList.remove("shake")}),400),n=Math.max(Math.min(n,5),0)),i!==n&&(this.arkOnlyGiftField.value=n,e(n))};this.arkOnlyGiftUpButton.addEventListener("click",(e=>{e.preventDefault(),t(1)})),this.arkOnlyGiftDownButton.addEventListener("click",(e=>{e.preventDefault(),t(-1)}))}},filter:function(e){const t=document.querySelectorAll(".checkout-wizard-list-game");let i=!0;for(const n of t){const t=n.getAttribute("beacon-game-id");0===e.length||e.includes(t)||("Ark"===t||"ArkSA"===t)&&(e.includes("Ark")||e.includes("ArkSA"))?(n.classList.remove("hidden"),i?(i=!1,n.classList.remove("separated")):n.classList.add("separated")):n.classList.add("hidden")}},present:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.filter(t),t.length>0&&!1===t.includes(n)&&(n=null),this.editCartItem=e,this.arkCheck.disabled=!1,this.arkSACheck&&(this.arkSACheck.disabled=!1);for(const e of w){const t=e.gameId.toLowerCase();this["".concat(t,"Check")]&&(this["".concat(t,"Check")].disabled=!1)}if(e){this.giftCheck.checked=e.isGift,this.giftCheck.disabled=!0,this.arkCheck.checked=e.hasArk,this.arkSACheck&&(this.arkSACheck.checked=e.hasArkSA);for(const t of w){const i=t.gameId,n=i.toLowerCase();this["".concat(n,"Check")]&&(this["".concat(n,"Check")].checked=e.hasGame(i))}}else{this.giftCheck.checked=!1,this.giftCheck.disabled=!1,this.arkCheck.checked="Ark"===n,this.arkSACheck&&(this.arkSACheck.checked="ArkSA"===n);for(const e of w){const t=e.gameId,i=t.toLowerCase();this["".concat(i,"Check")]&&(this["".concat(i,"Check")].checked=n===t)}}this.arkSADurationField&&(this.arkSADurationField.value=e?e.arkSAYears:"1");for(const t of w){const i=t.gameId,n=i.toLowerCase();this["".concat(n,"DurationField")].value=e?e.yearsForGame(i):"1"}this.cancelButton.innerText="Cancel",this.update(),i.showModal("checkout-wizard")},getGameStatus:function(){const e={Ark:y,ArkSA:y};for(const t of w)e[t.gameId]=y;const t=x.personalCartItem,i=Boolean(this.editCartItem);if(this.giftCheck&&this.giftCheck.checked){e.Ark=this.arkCheck&&!1===this.arkCheck.disabled&&this.arkCheck.checked?v:y,e.ArkSA=this.arkSACheck&&!1===this.arkSACheck.disabled&&this.arkSACheck.checked?v:y;for(const t of w){const i=t.gameId.toLowerCase();e[t.gameId]=this["".concat(i,"Check")]&&!1===this["".concat(i,"Check")].disabled&&this["".concat(i,"Check")].checked?v:y}}else{x.arkLicense?e.Ark=g:t&&(!1===i||t.id!==this.editCartItem.id)&&t.hasArk?e.Ark=f:this.arkCheck&&!1===this.arkCheck.disabled&&this.arkCheck.checked?e.Ark=v:e.Ark=y,x.arkSALicense?e.ArkSA=g:t&&(!1===i||t.id!==this.editCartItem.id)&&t.hasArkSA?e.ArkSA=f:this.arkSACheck&&this.arkSACheck&&!1===this.arkSACheck.disabled&&this.arkSACheck.checked?e.ArkSA=v:e.ArkSA=y;for(const r of w){var n;const s=r.gameId,o=s.toLowerCase();x.findLicense(null===(n=a[s])||void 0===n||null===(n=n.Base)||void 0===n?void 0:n.ProductId)?e[s]=g:t&&(!1===i||t.id!==this.editCartItem.id)&&t.hasGame(s)?e[s]=f:this["".concat(o,"Check")]&&!1===this["".concat(o,"Check")].disabled&&this["".concat(o,"Check")].checked?e[s]=v:e[s]=y}}return e},update:function(){const e=this.getGameStatus();let t=0;if(this.arkCheck&&!1===this.arkCheck.disabled&&!0===this.arkCheck.checked&&(t+=a.Ark.Base.Price),this.arkSACheck){let i=a.ArkSA.Base.Price,n=a.ArkSA.Base.Price;const r=Math.min(Math.max(parseInt(this.arkSADurationField.value)||1,1),5);parseInt(this.arkSADurationField.value)!==r&&document.activeElement!==this.arkSADurationField&&(this.arkSADurationField.value=r);const s=Math.max(r-1,0),l=Math.round((a.ArkSA.Base.Price-a.ArkSA.Upgrade.Price)/a.ArkSA.Base.Price*100);if(this.arkSAPromoField.innerText="".concat(l,"% off first year when bundled with ").concat(a.Ark.Base.Name),e.ArkSA===g){const e=x.arkSALicense,t=Math.floor(Date.now()/1e3),s=e.expiresEpoch,l=c(o(s),!1),d=(t>s?86400*Math.floor(t/86400)+86400:s)+a.ArkSA.Renewal.PlanLengthSeconds*r,u=c(o(d),!1);let h;h=t>s?'Renew your update plan<br>Expired on <span class="text-red">'.concat(l,'</span><br>New expiration: <span class="text-green">').concat(u,"</span>"):'Extend your update plan<br>Expires on <span class="text-green">'.concat(l,'</span><br>New expiration: <span class="text-green">').concat(u,"</span>"),this.arkSAStatusField.innerHTML=h,i=a.ArkSA.Renewal.Price*r,n=i,this.arkSAPromoField.innerText="",this.arkSAPromoField.classList.add("hidden")}else if(e.ArkSA===f)i=a.ArkSA.Renewal.Price*r,n=i,this.arkSAStatusField.innerText="Additional renewal years for ".concat(a.ArkSA.Base.Name," in your cart."),this.arkSAPromoField.innerText="",this.arkSAPromoField.classList.add("hidden");else if(e.Ark!==y){i=a.ArkSA.Base.Price+a.ArkSA.Renewal.Price*s,n=a.ArkSA.Upgrade.Price+a.ArkSA.Renewal.Price*s;const t=e.Ark===g?"because you own":"when bundled with";this.arkSAStatusField.innerText="Includes 1 year of app updates. Additional years cost ".concat(u(a.ArkSA.Renewal.Price)," each."),this.arkSAPromoField.innerText="".concat(l,"% off first year ").concat(t," ").concat(a.Ark.Base.Name),this.arkSAPromoField.classList.remove("hidden")}else this.arkSAStatusField.innerText="Includes 1 year of app updates. Additional years cost ".concat(u(a.ArkSA.Renewal.Price)," each."),this.arkSAPromoField.innerText="".concat(l,"% off first year when bundled with ").concat(a.Ark.Base.Name),this.arkSAPromoField.classList.remove("hidden"),i=a.ArkSA.Base.Price+a.ArkSA.Renewal.Price*s,n=i;this.arkSAPriceField.classList.toggle("checkout-wizard-discounted",i!==n),this.arkSAPriceField.innerText=u(i),this.arkSAUpgradePriceField.classList.toggle("hidden",i===n),this.arkSAUpgradePriceField.innerText=u(n),!1===this.arkSACheck.disabled&&!0===this.arkSACheck.checked&&(t+=n)}e.Ark===g?(this.arkStatusField.innerText="You already own ".concat(a.Ark.Base.Name,"."),this.arkCheck.disabled=!0,this.arkCheck.checked=!1):e.Ark===f?(this.arkStatusField.innerText="".concat(a.Ark.Base.Name," is already in your cart."),this.arkCheck.disabled=!0,this.arkCheck.checked=!1):(this.arkStatusField.innerText="Includes lifetime app updates.",this.arkCheck.disabled=!1);for(const y of w){var i,n;const w=y.gameId,S=w.toLowerCase(),b=this["".concat(S,"Check")],E=this["".concat(S,"DurationField")],C=this["".concat(S,"StatusField")],I=this["".concat(S,"PriceField")];if(!b)continue;let B=null===(i=a[w])||void 0===i||null===(i=i.Base)||void 0===i?void 0:i.Price;const L=null===(null===(n=a[w])||void 0===n||null===(n=n.Base)||void 0===n?void 0:n.PlanLengthSeconds),P=Math.min(Math.max(parseInt(E.value)||1,1),5);parseInt(E.value)!==P&&document.activeElement!==E&&(E.value=P);const T=Math.max(P-1,0);var r;if(L)if(e[w]===g)C.innerHTML="You already own ".concat(null===(r=a[w])||void 0===r||null===(r=r.Base)||void 0===r?void 0:r.Name,"."),b.disabled=!0,b.checked=!1;else if(e[w]===f){var s;C.innerText="".concat(null===(s=a[w])||void 0===s||null===(s=s.Base)||void 0===s?void 0:s.Name," is already in your cart."),b.disabled=!0,b.checked=!1}else C.innerText="Includes lifetime app updates.",b.disabled=!1;else if(e[w]===g){var l,d;const e=x.findLicense(null===(l=a[w])||void 0===l||null===(l=l.Base)||void 0===l?void 0:l.ProductId),t=Math.floor(Date.now()/1e3),i=e.expiresEpoch,n=c(o(i),!1),r=(t>i?86400*Math.floor(t/86400)+86400:i)+(null===(d=a[w])||void 0===d||null===(d=d.Renewal)||void 0===d?void 0:d.PlanLengthSeconds)*P,s=c(o(r),!1);let u;u=t>i?'Renew your update plan<br>Expired on <span class="text-red">'.concat(n,'</span><br>New expiration: <span class="text-green">').concat(s,"</span>"):'Extend your update plan<br>Expires on <span class="text-green">'.concat(n,'</span><br>New expiration: <span class="text-green">').concat(s,"</span>"),C.innerHTML=u}else if(e[w]===f){var h,m;B=(null===(h=a[w])||void 0===h||null===(h=h.Renewal)||void 0===h?void 0:h.Price)*P,C.innerText="Additional renewal years for ".concat(null===(m=a[w])||void 0===m||null===(m=m.Base)||void 0===m?void 0:m.Name," in your cart.")}else{var k,p,v,A;C.innerText="Includes ".concat(null===(k=a[w])||void 0===k||null===(k=k.Renewal)||void 0===k?void 0:k.PlanLength," of app updates. Additional years cost ").concat(u(null===(p=a[w])||void 0===p||null===(p=p.Renewal)||void 0===p?void 0:p.Price)," each."),B=(null===(v=a[w])||void 0===v||null===(v=v.Base)||void 0===v?void 0:v.Price)+(null===(A=a[w])||void 0===A||null===(A=A.Renewal)||void 0===A?void 0:A.Price)*T}I.innerText=u(B),!1===b.disabled&&!0===b.checked&&(t+=B)}const S=this.editCartItem?"Edit":"Add to Cart";t>0?(this.actionButton.disabled=!1,this.actionButton.innerText="".concat(S,": ").concat(u(t))):(this.actionButton.disabled=!0,this.actionButton.innerText=S)}},j={wizard:null,emailField:document.getElementById("storefront-cart-header-email-field"),changeEmailButton:document.getElementById("storefront-cart-header-email-button"),currencyMenu:document.getElementById("storefront-cart-currency-menu"),addMoreButton:document.getElementById("storefront-cart-more-button"),checkoutButton:document.getElementById("storefront-cart-checkout-button"),refundCheckbox:document.getElementById("storefront-refund-checkbox"),footer:document.getElementById("storefront-cart-footer"),body:document.getElementById("storefront-cart"),totalField:document.getElementById("storefront-cart-total"),init:function(e){this.wizard=e,this.currencyMenu.addEventListener("change",(e=>{e.preventDefault(),n.get("/omni/currency?currency=".concat(e.target.value)).then((()=>{window.location.reload()})).catch((e=>{console.log(JSON.stringify(e)),i.show("Currency was not changed",e.statusText)}))})),this.addMoreButton.addEventListener("click",(e=>{e.preventDefault(),this.wizard.present()})),this.checkoutButton.addEventListener("click",(e=>{e.preventDefault();const a=this.refundCheckbox.checked,r=e=>{this.update(),e?x.count>0?i.show("Your cart contents have changed.","The items in your cart have changed based on your e-mail address. Please review before continuing checkout."):i.show("Your cart is now empty.","You already own everything in your cart. There is no need to purchase again."):(this.checkoutButton.disabled=!0,n.post("https://".concat(t.apiDomain,"/v4/beginCheckout"),d(d({},x.toJSON()),{},{refundPolicyAgreed:a,successUrl:t.successUrl,cancelUrl:t.cancelUrl,currencyCode:t.currencyCode,affiliateId:t.affiliateId})).then((e=>{try{const t=JSON.parse(e.body).url;window.location=t}catch(t){console.log(e.body),i.show("Unknown Error","There was an unknown error while starting the checkout process.")}})).catch((e=>{try{const t=JSON.parse(e.body).message;i.show("Checkout Error",t)}catch(t){console.log(e.body),i.show("Unknown Error","There was an unknown error while starting the checkout process.")}})).finally((()=>{this.checkoutButton.disabled=!1})))};x.email?a?r(!1):i.show("Hang on","Please agree to the refund policy."):R.present(!1,r)})),this.changeEmailButton.addEventListener("click",(e=>{e.preventDefault(),R.present(!1,(()=>{this.update()}))})),this.update()},update:function(){if(x.count>0)this.emailField.innerText=x.email,this.changeEmailButton.disabled=Boolean(t.forceEmail),this.changeEmailButton.innerText=x.email?"Change Email":"Set Email",this.changeEmailButton.classList.remove("hidden"),this.body.innerText="",this.body.classList.remove("empty"),this.footer.classList.remove("hidden"),x.items.forEach((e=>{const t=this.createCartItemRow(e);t&&this.body.appendChild(t)})),D.innerText="Go to Cart";else{this.emailField.innerText="",this.changeEmailButton.classList.add("hidden"),this.body.innerText="",this.body.classList.add("empty"),this.footer.classList.add("hidden"),this.body.appendChild(document.createElement("div"));const e=document.createElement("div"),t=document.createElement("p");t.appendChild(document.createTextNode("Your cart is empty.")),e.appendChild(t),this.buyMoreButton=document.createElement("button"),this.buyMoreButton.addEventListener("click",(()=>{R.present(!0,(()=>{this.wizard.present()}))})),this.buyMoreButton.classList.add("default"),this.buyMoreButton.appendChild(document.createTextNode("Buy Omni"));const i=document.createElement("p");i.appendChild(this.buyMoreButton),e.appendChild(i),this.body.appendChild(e),this.body.appendChild(document.createElement("div")),D.innerText="Buy Omni"}var e;this.totalField.setAttribute("beacon-price",x.total),e=t.currencyCode,document.querySelectorAll(".formatted-price").forEach((t=>{var i;const n=parseFloat(null!==(i=t.getAttribute("beacon-price"))&&void 0!==i?i:t.innerText),a=t.getAttribute("beacon-currency"),r=s(null!=a?a:e);r&&(t.innerText=r(n))})),this.checkoutButton.disabled=0===x.total},createProductRow:function(e,t){const i=e.getQuantity(t);if(i<=0)return null;const n=l[t].Name,a=l[t].Price,r=document.createElement("div");r.appendChild(document.createTextNode(i));const s=document.createElement("div");s.appendChild(document.createTextNode(n));const o=document.createElement("div");o.classList.add("formatted-price"),o.appendChild(document.createTextNode(a*i));const c=document.createElement("div");return c.classList.add("bundle-product"),c.appendChild(r),c.appendChild(s),c.appendChild(o),c},createCartItemRow:function(e){const t=e.productIds;if(t.length<=0)return null;const i=document.createElement("div");i.classList.add("bundle"),t.forEach((t=>{const n=this.createProductRow(e,t);n&&i.appendChild(n)}));const n=document.createElement("div");e.isGift&&(i.classList.add("gift"),n.classList.add("gift"),t.length>1?n.appendChild(document.createTextNode("These products are a gift. You will receive a gift code for them.")):n.appendChild(document.createTextNode("This product is a gift. You will receive a gift code for it.")));const a=document.createElement("button");a.appendChild(document.createTextNode("Edit")),a.classList.add("small"),a.addEventListener("click",(t=>{t.preventDefault(),this.wizard.present(e)}));const r=document.createElement("button");r.appendChild(document.createTextNode("Remove")),r.classList.add("red"),r.classList.add("small"),r.addEventListener("click",(t=>{t.preventDefault(),x.remove(e),this.update()}));const s=document.createElement("div");s.classList.add("button-group"),s.appendChild(a),s.appendChild(r);const o=document.createElement("div");o.appendChild(s);const c=document.createElement("div");return c.classList.add("actions"),c.classList.add("double-group"),c.appendChild(n),c.appendChild(o),i.appendChild(c),i}};Q.init(j),j.init(Q);const z=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=window.location.hash.substring(1);if(A&&A.hasPage(t))return M.switchView("page-landing",e),void A.switchPage(t);window.scrollTo(window.scrollX,0),"checkout"===t?M.switchView("page-cart",e):M.back(e)};D.addEventListener("click",(e=>{e.preventDefault(),x.count>0?N():R.present(!0,(()=>{Q.present()}))}));for(const e of p){const t=e.gameId,i=document.getElementById("checkout-buy-".concat(t.toLowerCase(),"-button"));i&&i.addEventListener("click",(e=>{e.preventDefault();const i=()=>{Q.present(null,[t],t)};x.count>0?i():R.present(!0,i)}))}G.addEventListener("click",(()=>{A?(A.currentPageTitle?document.title="Beacon Omni for ".concat(A.currentPageTitle):document.title="Beacon Omni",history.pushState({},"","/omni#".concat(A.currentPageName))):(document.title="Beacon Omni",history.pushState({},"","/omni")),dispatchEvent(new PopStateEvent("popstate",{}))})),window.addEventListener("popstate",(()=>{z(!0)})),z(!1),t.forceEmail&&(x.email!==t.forceEmail&&x.reset(),0===x.count?R.present(!0,(()=>{Q.present()})):N())}))})();