(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,o(a.key),a)}}function n(e,t,n){return(t=o(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(t){var n=function(t,n){if("object"!==e(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var a=o.call(t,"string");if("object"!==e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===e(n)?n:String(n)}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,o;return n=e,o=[{key:"show",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Ok";return this.confirm(e,t,n,null)}},{key:"confirm",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Ok",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Cancel",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return new Promise((function(i,l){var c=document.getElementById("overlay"),s=document.getElementById("dialog"),u=document.getElementById("dialog_message"),d=document.getElementById("dialog_explanation"),m=document.getElementById("dialog_slot"),v=document.getElementById("dialog_action_button"),f=document.getElementById("dialog_cancel_button");c&&s&&u&&d&&v&&f?(c.className="exist",s.className="exist",setTimeout((function(){c.className="exist visible",s.className="exist visible"}),10),u.innerText=e,n?(d.innerText=n,d.classList.remove("hidden")):(d.innerText="",d.classList.add("hidden")),m&&(r?(m.innerHTML=r,m.classList.remove("hidden")):(m.innerText="",m.classList.add("hidden"))),v.clickHandler&&v.removeEventListener("click",v.clickHandler),f.clickHandler&&f.removeEventListener("click",f.clickHandler),v.clickHandler=function(){t.hide(),setTimeout((function(){i()}),300)},v.addEventListener("click",v.clickHandler),v.innerText=o,a?(f.clickHandler=function(){t.hide(),setTimeout((function(){l()}),300)},f.addEventListener("click",f.clickHandler),f.innerText=a):f.className="hidden"):l()}))}},{key:"hide",value:function(){var e=document.getElementById("overlay"),t=document.getElementById("dialog");e&&t&&(e.className="exist",t.className="exist",setTimeout((function(){e.className="",t.className=""}),300))}},{key:"showModal",value:function(e){var t=this;if(!this.activeModal){var n=document.getElementById("overlay"),o=document.getElementById(e);n&&o&&(n.classList.add("exist"),o.classList.add("exist"),this.activeModal=e,setTimeout((function(){n.classList.add("visible"),o.classList.add("visible")}),10),this.viewportWatcher=setInterval((function(){if(t.activeModal){document.querySelectorAll("#".concat(t.activeModal," .modal-content .content")).forEach((function(e){o.classList.toggle("scrolled",e.scrollHeight>e.clientHeight)}));var e=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0);o.classList.toggle("centered",o.clientHeight>.75*e)}}),100))}}},{key:"hideModal",value:function(){var e=this;return new Promise((function(t,n){if(e.activeModal){var o=document.getElementById("overlay"),a=document.getElementById(e.activeModal);o&&a?(e.viewportWatcher&&(clearInterval(e.viewportWatcher),e.viewportWatcher=null),o.classList.remove("visible"),a.classList.remove("visible"),setTimeout((function(){o.classList.remove("exist"),a.classList.remove("exist"),e.activeModal=null,t()}),300)):n()}else n()}))}}],null&&t(n.prototype,null),o&&t(n,o),Object.defineProperty(n,"prototype",{writable:!1}),e}();function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(void 0,a=function(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!==r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===r(a)?a:String(a)),o)}var a}n(a,"activeModal",null),n(a,"viewportWatcher",null),n(a,"secureConfirm",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Ok",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Cancel";return new Promise((function(i,l){var c;switch(e){case"password":c=a.confirm(t,n,o,r,'<div class="floating-label"><input type="password" class="text-field" id="dialog_confirm_field" placeholder="Account Password"><label for="dialog_confirm_field">Account Password</label></div>');break;case"anyAuthenticator":c=a.confirm(t,n,o,r,'<div class="floating-label"><input type="text" class="text-field" id="dialog_confirm_field" placeholder="Two Step Code"><label for="dialog_confirm_field">Two Step Code</label></div>');break;default:console.log("Unknown security option ".concat(e)),l("Unknown security option")}c.then((function(){var e=document.getElementById("dialog_confirm_field");i(e.value)})).catch((function(){l()}))}))}));var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"prepareResponse",value:function(e){return{xhr:e,status:e.status,statusText:e.statusText,body:e.responseText,success:e.status>=200&&e.status<300||304===e.status}}},{key:"start",value:function(e,t){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new Promise((function(i,l){var c=new XMLHttpRequest;if(c.open(e,t,!0),"object"===r(a)&&null!==a&&!1===Array.isArray(a))for(var s=0,u=Object.keys(a);s<u.length;s++){var d=u[s];c.setRequestHeader(d,a[d])}c.onload=function(){var e=n.prepareResponse(c);e.success?i(e):l(e)},c.onerror=function(){l(n.prepareResponse(c))},c.send(o)}))}},{key:"get",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.start("GET",t,null,n)}},{key:"post",value:function(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n instanceof URLSearchParams?(o["Content-Type"]="application/x-www-form-urlencoded",e.start("POST",t,n.toString(),o)):"object"===r(n)&&null!==n||Array.isArray(n)?(o["Content-Type"]="application/json",e.start("POST",t,JSON.stringify(n),o)):e.start("POST",t,n,o)}},{key:"delete",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.start("DELETE",t,null,n)}}],null&&i(t.prototype,null),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}document.addEventListener("beaconRunLoginPage",(function(e){var t=e.loginParams,n="";["login","totp","recover","verify","password","loading","authorize"].forEach((function(e){var t=document.getElementById("page_".concat(e));t&&(n?t.classList.add("hidden"):n=e)}));var o=function(e){var t=document.getElementById("page_".concat(n)),o=document.getElementById("page_".concat(e));t&&o&&(t.classList.add("hidden"),o.classList.remove("hidden"),n=e)},r=function e(t){var n,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=!1,r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,a=function(){};return{s:a,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,r=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw r}}}}(t);try{for(r.s();!(n=r.n()).done;){var i=n.value,l=i instanceof HTMLElement?i:document.getElementById(i);if(l&&(!1===o||""===l.value)){l.focus(),a=!0;break}}}catch(e){r.e(e)}finally{r.f()}!1===a&&!0===o&&e(t,!1)},i="",s=document.getElementById("login_form_intro"),u=document.getElementById("login_email_field"),d=document.getElementById("login_password_field"),m=document.getElementById("login_remember_check"),v=document.getElementById("login_recover_button"),f=document.getElementById("login_cancel_button"),g=document.getElementById("login_action_button"),h=document.getElementById("login_form_totp"),p=document.getElementById("totp_code_field"),y=document.getElementById("totp_remember_check"),w=document.getElementById("totp_cancel_button"),b=document.getElementById("login_recover_form"),E=document.getElementById("recover_email_field"),I=document.getElementById("recover_action_button"),_=document.getElementById("recover_cancel_button"),k=document.getElementById("login_verify_form"),S=document.getElementById("verify_code_field"),B=document.getElementById("verify_email_field"),L=document.getElementById("verify_cancel_button"),T=document.getElementById("verify_action_button"),P=document.getElementById("page_password"),x=document.getElementById("login_password_form"),O=document.getElementById("password_email_field"),N=document.getElementById("password_code_field"),U=document.getElementById("username_field"),A=document.getElementById("password_cancel_button"),C=document.getElementById("suggested-username-link"),M=document.getElementById("new-suggestion-link"),D=document.getElementById("password_initial_field"),R=document.getElementById("password_confirm_field"),H=document.getElementById("password_action_button"),J=document.getElementById("password_totp_paragraph"),j=document.getElementById("password_totp_label"),z=document.getElementById("password_totp_field"),W=document.getElementById("authorize_action_button"),q=document.getElementById("authorize_cancel_button"),G=document.getElementById("authorize_switch_button"),Y=t.return,F=!1,V=!1,X=null,$=t.email;if(!$&&localStorage&&(V=null!==(X=localStorage.getItem("email"))),sessionStorage){var K=sessionStorage.getItem("account_password");K&&(sessionStorage.removeItem("account_password"),t.userPassword=K)}if(u&&($?u.value=$:V&&(u.value=X)),m&&(m.checked=V),s||h){var Q=function(e){if(e.preventDefault(),!u&&!t.userId||!d)return console.log("Not enough fields"),!1;var n=t.userId,i=n?t.userId:u.value.trim(),c=d.value;if(m&&(F=m.checked),!1===F&&localStorage&&localStorage.removeItem("email"),sessionStorage&&sessionStorage.removeItem("email"),!i||c.length<8)return a.show("Incomplete Login","Email must not be blank and password must  have at least 8 characters."),!1;o("loading");var s={email:i,password:c,challenge:t.challenge,challengeExpiration:t.challengeExpiration,deviceId:t.deviceId,loginId:t.loginId};t.flowId&&(s.flowId=t.flowId);var v=p.value.trim();return!0===Boolean(v)&&(s.verificationCode=v,s.trust=y.checked),l.post("/account/auth/authenticate",s).then((function(e){n||(localStorage&&F&&i&&localStorage.setItem("email",i),sessionStorage&&sessionStorage.setItem("email",i));try{var o=JSON.parse(e.body),a=t.redeemUrl;a=a.replace("{{session_id}}",encodeURIComponent(o.accessToken)),a=(a=(a=t.flowId?a.replace("{{return_uri}}",encodeURIComponent(window.location.href)):a.replace("{{return_uri}}",encodeURIComponent(Y))).replace("{{user_password}}",encodeURIComponent(c))).replace("{{temporary}}",!1===F?"true":"false"),t.flowRequiresPassword&&sessionStorage&&sessionStorage.setItem("account_password",s.password),window.location=a}catch(e){console.log(e)}})).catch((function(e){var t;switch(console.log(JSON.stringify(e)),e.status){case 400:t="There was an expected error.";try{var n=JSON.parse(e.body),i=n.details.code;switch(n.message&&(t=n.message),i){case"CHALLENGE_TIMEOUT":t="The login process timed out. Please try again.";break;case"COMPLETED":t="This authorization has already been completed. Please start again."}}catch(e){}a.show("Unable to complete login",t).then((function(){o("login")}));break;case 401:case 403:try{if("2FA_ENABLED"===JSON.parse(e.body).details.code){o("totp"),r([p]);break}}catch(e){}a.show("Incorrect Login","Email or password is not correct.").then((function(){o("login")}));break;default:a.show("Unable to complete login","Sorry, there was a ".concat(e.status," error.")).then((function(){o("login")}))}})),!1};s&&s.addEventListener("submit",Q),h&&h.addEventListener("submit",Q)}if(v&&v.addEventListener("click",(function(e){return e.preventDefault(),E&&u&&(E.value=u.value),o("recover"),r([E]),!1})),f&&f.addEventListener("click",(function(e){return e.preventDefault(),window.location="beacon://dismiss",!1})),w&&w.addEventListener("click",(function(e){e.preventDefault(),o("login"),r([d])})),b&&b.addEventListener("submit",(function(e){if(e.preventDefault(),I&&(I.disabled=!0),E){var n=new URLSearchParams;n.append("email",E.value.trim()),t.loginId&&n.append("flowId",t.loginId);var i=new URLSearchParams(window.location.search);return i.has("return")&&n.append("return",i.get("return")),l.post("/account/auth/email",n).then((function(e){try{var t=JSON.parse(e.body);I&&(I.disabled=!1),t.verified?(O&&(O.value=t.email),o("password"),r([D,R,H])):(B&&(B.value=t.email),o("verify"),r([S,T]))}catch(e){console.log(e)}})).catch((function(e){console.log(JSON.stringify(e)),I&&(I.disabled=!1);var t={message:"Unable to continue",explanation:"There was a ".concat(e.status," error while trying to send the verification email.")};try{var n=JSON.parse(e.body);n.message&&(t.explanation=n.message)}catch(e){console.log(e)}a.show(t.message,t.explanation).then((function(){o("recover")}))})),!1}console.log("Missing email field")})),_&&_.addEventListener("click",(function(e){return e.preventDefault(),o("login"),r([u,d,g]),!1})),k&&k.addEventListener("submit",(function(e){if(e.preventDefault(),S&&B){o("loading");var t=new URLSearchParams;return t.append("email",B.value.trim()),t.append("code",S.value.trim()),l.post("/account/auth/verify",t).then((function(e){try{var t=JSON.parse(e.body);t.verified?(O&&N&&(O.value=t.email,N.value=t.code),t.username&&U&&(U.value=t.username,P.className="as-recover-user"),o("password"),r([U,D,R,H])):a.show("Incorrect code","The code entered is not correct.").then((function(){o("verify"),S&&(S.value="",S.focus())}))}catch(e){console.log(e)}})).catch((function(e){console.log(JSON.stringify(e)),a.show("Unable to confirm","There was a ".concat(e.status," error while trying to verify the code.")).then((function(){o("verify")}))})),!1}console.log("Missing fields")})),L&&L.addEventListener("click",(function(e){return e.preventDefault(),o("login"),r([u,d,g]),!1})),x){var Z=!1;x.addEventListener("submit",(function(e){e.preventDefault();var t=O?O.value.trim():"",n=N?N.value.trim():"",r=U?U.value:"",c=D?D.value:"",m=R?R.value:"",v=c===i,f=z?z.value:"";if(c.length<8)return a.show("Password too short","Your password must be at least 8 characters long."),!1;if(c!==m)return a.show("Passwords do not match","Please make sure the two passwords match."),!1;var g=new URLSearchParams;g.append("email",t),g.append("username",r),g.append("password",c),g.append("code",n),g.append("allow_vulnerable",v),g.append("confirm_reset_children",Z),g.append("verification_code",f),o("loading"),l.post("/account/auth/password",g).then((function(){try{localStorage&&F&&localStorage.setItem("email",t),u.value=t,d.value=c,p.value=f,s.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0}))}catch(e){console.log(e)}})).catch((function(e){var t;console.log(JSON.stringify(e));try{var n=JSON.parse(e.body);switch(e.status){case 403:J&&(J.classList.contains("hidden")?J.classList.remove("hidden"):(j&&(j.classList.add("invalid"),j.innerText="Incorrect Code"),z&&z.classList.add("invalid"),setTimeout((function(){j&&(j.classList.remove("invalid"),j.innerText="Two Step Verification Code"),z&&z.classList.remove("invalid")}),3e3))),o("password");break;case 436:case 437:t=a.show("Unable to create Beacon account.",n.message);break;case 438:i=c,t=a.show("Your password is vulnerable.","Your password has been leaked in a previous breach and should not be used. To ignore this warning, you may submit the password again, but that is not recommended.");break;case 439:a.confirm("WARNING!",'Your team members will be unable to sign into their accounts until you reset each of their passwords once you sign in. See the "Team" section of your Beacon account control panel.',"Reset Password").then((function(){Z=!0,x.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0}))})).catch((function(){o("password")}));break;default:t=a.show("Unable to create user","There was a ".concat(e.status," error while trying to create your account."))}t&&t.then((function(){o("password")}))}catch(e){console.log(e)}}))}))}A&&A.addEventListener("click",(function(e){return e.preventDefault(),o("login"),r([u,d,g]),!1})),C&&C.addEventListener("click",(function(e){return e.preventDefault(),U&&(U.value=e.target.getAttribute("beacon-username")),!1})),M&&M.addEventListener("click",(function(e){return l.get("/account/login/suggest").then((function(e){try{var t=JSON.parse(e.body);C&&(C.innerText=t.username,C.setAttribute("beacon-username",t.username))}catch(e){console.log(e)}})).catch((function(e){console.log(JSON.stringify(e))})),e.preventDefault(),!1})),q&&q.addEventListener("click",(function(){d&&(d.value=""),t.useAppCancelBehavior?window.location="beacon://dismiss":window.location="/account/"})),G&&G.addEventListener("click",(function(e){e.preventDefault();var t=window.location;window.location="/account/auth/redeem?return="+encodeURIComponent(t)})),W&&W.addEventListener("click",(function(){var e={deviceId:t.deviceId,flowId:t.flowId,challenge:t.challenge,challengeExpiration:t.challengeExpiration},n=null;t.userPassword?(e.password=t.userPassword,n=new Promise((function(e){e()}))):n=new Promise((function(t,n){var o=document.getElementById("authorizePasswordFieldGroup"),r=document.getElementById("authorizePasswordField"),i=document.getElementById("authorizePasswordActionButton"),l=document.getElementById("authorizePasswordCancelButton");i.addEventListener("click",(function n(l){if(l.preventDefault(),r.value.length<8)return o.classList.add("shake"),void setTimeout((function(){o.classList.remove("shake")}),400);e.password=r.value,i.removeEventListener("click",n),a.hideModal().then((function(){r.value="",t()}))})),l.addEventListener("click",(function t(o){o.preventDefault(),e.password=null,l.removeEventListener("click",t),a.hideModal().then((function(){r.value="",n()}))})),r.value="",a.showModal("authorizePasswordDialog")})),n.then((function(){l.post("/account/auth/authorize",e).then((function(e){try{var t=JSON.parse(e.body).callback;window.location=t}catch(e){console.log(e),a.show("Unexpected error","There was an error: ".concat(e.message))}})).catch((function(e){console.log(JSON.stringify(e));try{var t,n=null!==(t=JSON.parse(e.body).message)&&void 0!==t?t:"There was a ".concat(e.status," error");a.show("Unable to authorize app",n)}catch(e){console.log(e),a.show("Unexpected error","There was an error: ".concat(e.message))}}))})).catch((function(){}))})),"#create"===window.location.hash?(E&&$&&(E.value=$),o("recover")):t.email&&t.code&&(B.value=t.email,S.value=t.code,k.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0})))}))})();