(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,s=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return c=e.done,e},e:function(e){s=!0,i=e},f:function(){try{c||null==a.return||a.return()}finally{if(s)throw i}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,r(a.key),a)}}function o(e,t,n){return(t=r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(t){var n=function(t,n){if("object"!==e(t)||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var o=a.call(t,"string");if("object"!==e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===e(n)?n:String(n)}var i=function(){function e(n){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o(this,"element",null),o(this,"pageMap",{}),o(this,"currentPageName",null),o(this,"currentPageTitle",null),this.element=n;var r,i=t(n.querySelectorAll("div.page-panel-page"));try{for(i.s();!(r=i.n()).done;){var c=r.value,s=c.getAttribute("page");this.pageMap[s]=c,c.classList.contains("page-panel-visible")&&(this.currentPageName=s)}}catch(e){i.e(e)}finally{i.f()}var l,u=t(n.querySelectorAll("div.page-panel-nav a"));try{for(u.s();!(l=u.n()).done;){var d=l.value,p=d.getAttribute("page");this.pageMap[p]&&(this.pageMap[p].link=d,d.addEventListener("click",(function(e){e.preventDefault(),a.switchPage(e.target.getAttribute("page"))})))}}catch(e){u.e(e)}finally{u.f()}var h=new Event("panelCreated");h.panel=this,this.element.dispatchEvent(h)}var n,r,i;return n=e,i=[{key:"init",value:function(){var n,a=t(document.querySelectorAll("div.page-panel"));try{for(a.s();!(n=a.n()).done;){var o=n.value;e.pagePanels[o.id]=new e(o)}}catch(e){a.e(e)}finally{a.f()}}}],(r=[{key:"switchPage",value:function(e){var t=this.currentPageName;if(t!==e&&this.pageMap[e]){this.pageMap[t].classList.remove("page-panel-visible"),this.pageMap[t].link.parentElement.classList.remove("page-panel-active"),this.pageMap[e].classList.add("page-panel-visible"),this.pageMap[e].link.parentElement.classList.add("page-panel-active"),this.currentPageName=e,this.currentPageTitle=this.pageMap[e].link.innerText;var n=new Event("panelSwitched");n.panel=this,this.element.dispatchEvent(n)}}},{key:"hasPage",value:function(e){return Object.hasOwn?Object.hasOwn(this.pageMap,e):Object.prototype.hasOwnProperty.call(this.pageMap,e)}}])&&a(n.prototype,r),i&&a(n,i),Object.defineProperty(n,"prototype",{writable:!1}),e}();function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function s(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,u(a.key),a)}}function l(e,t,n){return(t=u(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e){var t=function(e,t){if("object"!==c(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,"string");if("object"!==c(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===c(t)?t:String(t)}o(i,"pagePanels",{});var d="anyAuthenticator",p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"show",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Ok";return this.confirm(e,t,n,null)}},{key:"confirm",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Ok",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Cancel",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return new Promise((function(i,c){var s=document.getElementById("overlay"),l=document.getElementById("dialog"),u=document.getElementById("dialog_message"),d=document.getElementById("dialog_explanation"),p=document.getElementById("dialog_slot"),h=document.getElementById("dialog_action_button"),m=document.getElementById("dialog_cancel_button");s&&l&&u&&d&&h&&m?(s.className="exist",l.className="exist",setTimeout((function(){s.className="exist visible",l.className="exist visible"}),10),u.innerText=e,n?(d.innerText=n,d.classList.remove("hidden")):(d.innerText="",d.classList.add("hidden")),p&&(r?(p.innerHTML=r,p.classList.remove("hidden")):(p.innerText="",p.classList.add("hidden"))),h.clickHandler&&h.removeEventListener("click",h.clickHandler),m.clickHandler&&m.removeEventListener("click",m.clickHandler),h.clickHandler=function(){t.hide(),setTimeout((function(){i()}),300)},h.addEventListener("click",h.clickHandler),h.innerText=a,o?(m.clickHandler=function(){t.hide(),setTimeout((function(){c()}),300)},m.addEventListener("click",m.clickHandler),m.innerText=o):m.className="hidden"):c()}))}},{key:"hide",value:function(){var e=document.getElementById("overlay"),t=document.getElementById("dialog");e&&t&&(e.className="exist",t.className="exist",setTimeout((function(){e.className="",t.className=""}),300))}},{key:"showModal",value:function(e){var t=this;if(!this.activeModal){var n=document.getElementById("overlay"),a=document.getElementById(e);n&&a&&(n.classList.add("exist"),a.classList.add("exist"),this.activeModal=e,setTimeout((function(){n.classList.add("visible"),a.classList.add("visible")}),10),this.viewportWatcher=setInterval((function(){if(t.activeModal){document.querySelectorAll("#".concat(t.activeModal," .modal-content .content")).forEach((function(e){a.classList.toggle("scrolled",e.scrollHeight>e.clientHeight)}));var e=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0);a.classList.toggle("centered",a.clientHeight>.75*e)}}),100))}}},{key:"hideModal",value:function(){var e=this;return new Promise((function(t,n){if(e.activeModal){var a=document.getElementById("overlay"),o=document.getElementById(e.activeModal);a&&o?(e.viewportWatcher&&(clearInterval(e.viewportWatcher),e.viewportWatcher=null),a.classList.remove("visible"),o.classList.remove("visible"),setTimeout((function(){a.classList.remove("exist"),o.classList.remove("exist"),e.activeModal=null,t()}),300)):n()}else n()}))}}],null&&s(t.prototype,null),n&&s(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function m(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==h(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,"string");if("object"!==h(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(a.key),"symbol"===h(o)?o:String(o)),a)}var o}l(p,"activeModal",null),l(p,"viewportWatcher",null),l(p,"secureConfirm",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Ok",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Cancel";return new Promise((function(r,i){var c;switch(e){case"password":c=p.confirm(t,n,a,o,'<div class="floating-label"><input type="password" class="text-field" id="dialog_confirm_field" placeholder="Account Password"><label for="dialog_confirm_field">Account Password</label></div>');break;case d:c=p.confirm(t,n,a,o,'<div class="floating-label"><input type="text" class="text-field" id="dialog_confirm_field" placeholder="Two Step Code"><label for="dialog_confirm_field">Two Step Code</label></div>');break;default:console.log("Unknown security option ".concat(e)),i("Unknown security option")}c.then((function(){var e=document.getElementById("dialog_confirm_field");r(e.value)})).catch((function(){i()}))}))}));var f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"prepareResponse",value:function(e){return{xhr:e,status:e.status,statusText:e.statusText,body:e.responseText,success:e.status>=200&&e.status<300||304===e.status}}},{key:"start",value:function(e,t){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new Promise((function(r,i){var c=new XMLHttpRequest;if(c.open(e,t,!0),"object"===h(o)&&null!==o&&!1===Array.isArray(o))for(var s=0,l=Object.keys(o);s<l.length;s++){var u=l[s];c.setRequestHeader(u,o[u])}c.onload=function(){var e=n.prepareResponse(c);e.success?r(e):i(e)},c.onerror=function(){i(n.prepareResponse(c))},c.send(a)}))}},{key:"get",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.start("GET",t,null,n)}},{key:"post",value:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n instanceof URLSearchParams?(a["Content-Type"]="application/x-www-form-urlencoded",e.start("POST",t,n.toString(),a)):"object"===h(n)&&null!==n||Array.isArray(n)?(a["Content-Type"]="application/json",e.start("POST",t,JSON.stringify(n),a)):e.start("POST",t,n,a)}},{key:"delete",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.start("DELETE",t,null,n)}}],null&&m(t.prototype,null),n&&m(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),v=function(){return crypto.randomUUID?crypto.randomUUID():([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)}))};function g(e){return function(e){if(Array.isArray(e))return w(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||b(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=b(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,r=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw r}}}}function b(e,t){if(e){if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}document.addEventListener("beaconRunAccountPanel",(function(e){var t=e.accountProperties,n="",a=t.sessionId,o=t.apiDomain,r=document.getElementById("account-user-header"),c=r.getAttribute("beacon-user-name"),s=r.getAttribute("beacon-user-suffix"),l="".concat(c,"#").concat(s),u=function(){var e=window.location.hash;return e?(e.startsWith("#")&&(e=e.substr(1)),e):""};i.init();var h=i.pagePanels["panel-account"];h&&(h.switchPage(u()),window.addEventListener("popstate",(function(){h.switchPage(u())})));var m=document.getElementById("panel-account");m&&m.addEventListener("panelSwitched",(function(e){window.location.hash=e.panel.currentPageName}));var b,w=y(document.querySelectorAll('#panel-account div[page="projects"] [beacon-action="delete"]'));try{for(w.s();!(b=w.n()).done;)b.value.addEventListener("click",(function(e){e.preventDefault();var t=e.target.getAttribute("beacon-resource-url"),n=e.target.getAttribute("beacon-resource-name");return p.confirm('Are you sure you want to delete the project "'+n+'?"',"The project will be deleted immediately and cannot be recovered.","Delete").then((function(){f.delete(t,{"X-Beacon-Token":a}).then((function(){p.show("Project deleted",'"'+n+'" has been deleted.').then((function(){window.location.reload(!0)}))})).catch((function(e){401===e.status?p.show("Project not deleted","There was an authentication error"):p.show("Project not deleted","Sorry, there was a ".concat(e.status," error."))}))})).catch((function(){})),!1}))}catch(e){w.e(e)}finally{w.f()}var E=document.getElementById("username_action_button"),k=document.getElementById("username_field"),S=document.getElementById("suggested-username-link"),T=document.getElementById("new-suggestion-link");E&&k&&(k.addEventListener("input",(function(e){E.disabled=""===e.target.value.trim()})),E.addEventListener("click",(function(e){e.preventDefault();var t=k.value.trim();if(""===t)return p.show("Username can not be empty","How did you press the button anyway?"),!1;var n=new URLSearchParams;n.append("username",t),f.post("/account/actions/username",n).then((function(e){var t={message:"Username changed",explanation:"Your username has been changed."};try{var n=JSON.parse(e.body);t.explanation='Your username has been changed to "'.concat(n.username,'."')}catch(e){}p.show(t.message,t.explanation).then((function(){window.location.reload(!0)}))})).catch((function(e){switch(e.status){case 401:case 403:p.show("Username not changed","There was an authentication error.");break;default:p.show("Username not changed","Sorry, there was a ".concat(e.status," error."))}}))})),S&&(S.addEventListener("click",(function(e){return e.preventDefault(),k.value=e.currentTarget.getAttribute("beacon-username"),E.disabled=""===k.value.trim(),!1})),T&&T.addEventListener("click",(function(e){return f.get("/account/login/suggest").then((function(e){try{var t=JSON.parse(e.body);S&&(S.innerText=t.username,S.setAttribute("beacon-username",t.username))}catch(e){}})).catch((function(){})),e.preventDefault(),!1}))));var I=document.getElementById("email_field"),L=document.getElementById("email_action_button"),B=document.getElementById("email_need_2fa"),A=document.getElementById("email_2fa_action_button"),x=document.getElementById("email_2fa_cancel_button"),P=document.getElementById("email_2fa_code_field");if(I&&L&&B){I.addEventListener("input",(function(e){L.disabled=""===e.target.value.trim()}));var _=function(){var e=new URLSearchParams;e.append("email",I.value.trim()),e.append("verify",P?P.value.trim():""),f.post("/account/actions/email",e).then((function(){p.show("Email Change Started","The new address has been emailed a link. Please click the link to complete the change.").then((function(){window.location.reload(!0)}))})).catch((function(e){try{var t=JSON.parse(e.body);if(!t.message)throw new Error;var n=t.message;p.show("Email Change Error",n)}catch(t){switch(e.status){case 401:case 403:p.show("Email Change Error","There was an authentication error.");break;default:p.show("Email Change Error","Sorry, there was a ".concat(e.status," error."))}}}))};L.addEventListener("click",(function(e){e.preventDefault(),"true"===B.value?(P.value="",p.showModal("change_email_2fa_form"),P.focus()):_()})),A&&A.addEventListener("click",(function(e){e.preventDefault(),p.hideModal().then((function(){_()}))})),x&&x.addEventListener("click",(function(e){e.preventDefault(),p.hideModal()})),P&&P.addEventListener("input",(function(e){A.disabled=""===e.target.value.trim()}))}var O=document.getElementById("password_action_button"),M=document.getElementById("password_regenerate_check"),U=document.getElementById("change_password_form"),j=document.getElementById("password_current_field"),C=document.getElementById("password_initial_field"),N=document.getElementById("password_confirm_field"),D=document.getElementById("password_auth_field"),R=document.getElementById("add-authenticator-button"),H=document.getElementById("add-authenticator-code-field"),J=document.getElementById("add-authenticator-password-field"),q=document.getElementById("add-authenticator-nickname-field"),Y=document.getElementById("add-authenticator-action-button"),X=document.getElementById("add-authenticator-cancel-button"),W=document.getElementById("add-authenticator-qrcode"),F=document.getElementById("add-authenticator-error-message"),G=document.getElementById("authenticators_time_zone_name"),V=document.getElementById("replace-backup-codes-button");O&&M&&U&&O.addEventListener("click",(function(e){e.preventDefault();var t=j?j.value:"",a=C?C.value:"",o=N?N.value:"",r=a===n,i=M.checked,c=i;if(a.length<8)return p.show("Password too short","Your password must be at least 8 characters long."),!1;if(a!==o)return p.show("Passwords do not match","Please make sure the two passwords match."),!1;var s=new URLSearchParams;return s.append("current_password",t),s.append("password",a),s.append("allow_vulnerable",r),c&&s.append("terminate_sessions",!0),i&&s.append("regenerate_key",!0),D&&s.append("auth_code",D.value),f.post("/account/actions/password",s).then((function(){U.reset();try{var e={};e.message=i?"Your password and private key have been changed.":"Your password has been changed.",e.explanation="All sessions have been revoked and your devices will need to sign in again.",p.show(e.message,e.explanation)}catch(e){console.log(e),p.show("There was an error. Your password may or may not have been changed.")}})).catch((function(e){var t="Unable to change password",o="There was a ".concat(e.status," error while trying to change your password.");try{var r=JSON.parse(e.body);r.message&&(o=r.message)}catch(e){}switch(e.status){case 403:t="Incorrect Two Step Verification Code",o="Please get a new code from your authenticator app.";break;case 438:n=a,t="Your password is vulnerable.",o="Your password has been leaked in a previous breach and should not be used. To ignore this warning, you may submit the password again, but that is not recommended."}p.show(t,o)})),!1}));var Z=function(){if(O)return j&&C&&N?void(O.disabled=""===j.value.trim()||""===C.value.trim()||C.value!==N.value):(console.log("Missing page fields"),void(O.disabled=!0))};if(j&&j.addEventListener("input",Z),C&&C.addEventListener("input",Z),N&&N.addEventListener("input",Z),R&&J&&H&&q&&Y&&X)try{var z={authenticatorId:v(),type:"TOTP",nickname:"Google Authenticator",metadata:{secret:null,setup:null}},$=function(){Y.disabled=""===H.value.trim()||""===J.value||""===q.value};H.addEventListener("input",$),J.addEventListener("input",$),q.addEventListener("input",$),R.addEventListener("click",(function(){z.metadata.secret=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",t=new Uint32Array(4);self.crypto.getRandomValues(t);var n,a="",o=y(t);try{for(o.s();!(n=o.n()).done;){var r=n.value;a+=e[r>>>27&31]+e[r>>>22&31]+e[r>>>17&31]+e[r>>>12&31]+e[r>>>7&31]+e[r>>>2&31]}}catch(e){o.e(e)}finally{o.f()}return a}(),z.metadata.setup="otpauth://totp/".concat(encodeURIComponent("Beacon:"+l+" ("+z.authenticatorId+")"),"?secret=").concat(z.metadata.secret,"&issuer=Beacon"),W&&(W.src="/account/assets/qr.php?content=".concat(btoa(z.metadata.setup)),W.setAttribute("alt",z.metadata.setup),W.setAttribute("title",z.metadata.setup)),H.value="",p.showModal("add-authenticator-modal")})),X.addEventListener("click",(function(){p.hideModal()})),Y.addEventListener("click",(function(){F.innerText="",F.classList.add("hidden"),z.nickname=q.value.trim(),z.verificationCode=H.value.trim(),z.password=J.value,f.post("https://".concat(o,"/v4/authenticators"),z,{"X-Beacon-Token":a}).then((function(){window.location.reload(!0)})).catch((function(e){F.innerText=function(){try{return JSON.parse(e.body).message}catch(e){return"Incorrect verification code"}}(),F.classList.remove("hidden")}))}))}catch(e){R.addEventListener("click",(function(){p.show("Sorry, this browser is not supported","There was an error generating the authenticator, which means your browser does not support modern cryptography features. Try again with an updated browser.")}))}var K=document.querySelectorAll("#authenticators-table tbody tr").length;if(K>0){(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];document.querySelectorAll("time").forEach((function(n){var a=new Date(n.getAttribute("datetime"));n.innerText=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=Intl.DateTimeFormat().resolvedOptions(),o={dateStyle:"medium"};t&&(o.timeStyle="short");var r=Intl.DateTimeFormat(a.locale,o).format(e);return n&&(r="".concat(r," ").concat(a.timeZone)),r}(a,e,t)}))})(!0,!1),G&&(G.innerText=Intl.DateTimeFormat().resolvedOptions().timeZone);var Q,ee=y(document.querySelectorAll("button.delete_authenticator_button"));try{for(ee.s();!(Q=ee.n()).done;)Q.value.addEventListener("click",(function(e){var t=e.target.getAttribute("beacon-authenticator-id"),n=e.target.getAttribute("beacon-authenticator-name"),r={message:"Are you sure you want to delete the authenticator ".concat(n,"?")};if(K>1){var i=K-1,c=1===i?"authenticator":"authenticators";r.explanation="You will have ".concat(i," ").concat(c," remaining. Your account will still be protected by two factor authentication.")}else r.explanation="This is your only authenticator. Deleting it will disable two factor authentication for your account. You will be able to add a new authenticator to enable two factor authentication again.";r.explanation+=" To delete this authenticator, please use it to generate a code",p.secureConfirm(d,r.message,r.explanation).then((function(e){f.start("DELETE","https://".concat(o,"/v4/authenticators"),JSON.stringify({authenticatorId:t,authCode:e}),{"X-Beacon-Token":a,"Content-Type":"application/json"}).then((function(){var e=document.getElementById("authenticator-".concat(t));e&&K>1?(e.remove(),K--):window.location.reload(!0)})).catch((function(e){var t={message:"The authenticator was not deleted",explanation:"There was a ".concat(e.status," error.")};try{var n=JSON.parse(e.body);n.message&&(t.explanation=n.message)}catch(e){}p.show(t.message,t.explanation)}))})).catch((function(){}))}))}catch(e){ee.e(e)}finally{ee.f()}}V&&V.addEventListener("click",(function(){p.confirm("Replace backup codes?","This will replace all of your backup codes with new ones.").then((function(){f.post("/account/actions/replace_backup_codes",{},{"X-Beacon-Token":a}).then((function(e){try{var t=document.getElementById("backup-codes"),n=JSON.parse(e.body).codes;t.innerHTML="";var a,o=y(n);try{for(o.s();!(a=o.n()).done;){var r=a.value,i=document.createElement("div");i.innerText=r,i.className="flex-grid-item",t.appendChild(i)}}catch(e){o.e(e)}finally{o.f()}}catch(e){window.location.reload(!0)}})).catch((function(e){console.log(JSON.stringify(e));var t={message:"Backup codes not replaced",explanation:"There was a ".concat(e.status," error.")};try{var n=JSON.parse(e.body);n.message&&(t.explanation=n.message)}catch(e){}p.show(t.message,t.explanation)}))})).catch((function(){}))}));var te,ne=function(e){return e.preventDefault(),f.delete("https://".concat(o,"/v4/sessions/").concat(encodeURIComponent(e.target.getAttribute("sessionHash"))),{"X-Beacon-Token":a}).then((function(){p.show("Session revoked","Be aware that any enabled user with a copy of your account's private key can start a new session.").then((function(){window.location.reload(!0)}))})).catch((function(e){401===e.status?p.show("Session not revoked","There was an authentication error"):p.show("Session not revoked","Sorry, there was a "+e.status+" error.")})),!1},ae=y(document.querySelectorAll('#panel-account div[page="sessions"] a.revokeLink'));try{for(ae.s();!(te=ae.n()).done;)te.value.addEventListener("click",ne)}catch(e){ae.e(e)}finally{ae.f()}var oe=document.getElementById("apps-create-button"),re=document.getElementById("app-editor-cancel-button"),ie=document.getElementById("app-editor-action-button"),ce=document.getElementById("app-editor-icon-choose-button"),se=document.getElementById("app-editor-icon-chooser"),le=document.getElementById("app-editor-icon-cell"),ue=document.getElementById("app-editor-icon-disclaimer"),de=document.getElementById("app-editor-name-field"),pe=document.getElementById("app-editor-website-field"),he=document.getElementById("app-editor-security-group"),me=document.getElementById("app-editor-confidential-check"),fe=Array.from(document.querySelectorAll(".app-scope-checkbox")),ve=document.getElementById("app-editor-secret-hint"),ge=document.getElementById("app-editor-callbacks-field");if(oe&&re&&ie&&ce&&se&&le&&de&&pe&&he&&me){var ye,be,we,Ee=function(e){var t,n,a,o,r;we=!Object.hasOwn(e,"applicationId"),ye=null!==(t=e.applicationId)&&void 0!==t?t:v(),de.value=null!==(n=e.name)&&void 0!==n?n:"",pe.value=null!==(a=e.website)&&void 0!==a?a:"",e.applicationId?he.classList.add("hidden"):he.classList.remove("hidden"),me.checked=!1;var i,c=y(fe);try{for(c.s();!(i=c.n()).done;){var s,l=i.value;l.checked=null===(s=e.scopes)||void 0===s?void 0:s.includes(l.value)}}catch(e){c.e(e)}finally{c.f()}e.iconUrls?(le.setAttribute("src",e.iconUrls[64]),le.setAttribute("srcset","".concat(e.iconUrls[64],", ").concat(e.iconUrls[128]," 2x, ").concat(e.iconUrls[256]," 3x"))):(le.setAttribute("src","https://assets.usebeacon.app/images/avatars/default/64px.png"),le.setAttribute("srcset","https://assets.usebeacon.app/images/avatars/default/64px.png, https://assets.usebeacon.app/images/avatars/default/128px.png 2x, https://assets.usebeacon.app/images/avatars/default/256px.png 3x")),se.value=null,be=e.scopes?e.scopes.filter((function(e){return!fe.some((function(t){return t.value===e}))})):[],ge.value=null!==(o=null===(r=e.callbacks)||void 0===r?void 0:r.join("\n"))&&void 0!==o?o:"",ue&&ue.classList.add("hidden"),ie.innerText=we?"Add":"Update",p.showModal("app-editor-modal")},ke=function(e){e.preventDefault();var t=e.currentTarget.getAttribute("beacon-app-id");f.get("https://".concat(o,"/v4/applications/").concat(encodeURIComponent(t)),{"X-Beacon-Token":a}).then((function(e){var t=JSON.parse(e.body);Ee(t)})).catch((function(){p.show("Could not retrieve application info")}))},Se=function(e){e.preventDefault();var t=e.currentTarget.getAttribute("beacon-app-id");p.secureConfirm(d,"Are you sure you want to delete this application?","All user logins created by this application will be invalidated. To delete this application, please enter a code from your authenticator app.").then((function(e){f.start("DELETE","https://".concat(o,"/v4/applications"),JSON.stringify({applicationId:t,authCode:e}),{"X-Beacon-Token":a,"Content-Type":"application/json"}).then((function(){p.show("The application has been deleted").then((function(){location.reload()}))})).catch((function(e){var t=JSON.parse(e.body),n=t.message;"invalidAuthCode"===t.code&&(n="The authenticator code is not correct. Please provide a code from any of your authenticator apps, not a backup code."),p.show("The application could not be deleted",n)}))})).catch((function(){console.log("App delete was cancelled")}))};document.querySelectorAll('#panel-account div[page="apps"] button.apps-edit-button').forEach((function(e){e.addEventListener("click",ke)})),document.querySelectorAll('#panel-account div[page="apps"] button.apps-delete-button').forEach((function(e){e.addEventListener("click",Se)})),oe.addEventListener("click",(function(e){e.preventDefault(),Ee({})})),ie.addEventListener("click",(function(e){e.preventDefault(),e.target.disabled=!0,re.disabled=!0;var t={applicationId:ye,name:de.value,website:pe.value,scopes:[].concat(g(be),g(fe.filter((function(e){return e.checked})).map((function(e){return e.value})))).sort(),callbacks:ge.value.replace(/(\r\n)|\r|\n/g,"\n").split("\n")};we&&me.value&&(t.secret="plink");var n,r=function(){var e={"X-Beacon-Token":a,"Content-Type":"application/json"},n=function(e){var t=JSON.parse(e.body);t.secret?p.hideModal().then((function(){p.show("Your application has been registered.","Your secret is below. You will not be shown this secret again.\n\n".concat(t.secret)).then((function(){location.reload()}))})):location.reload()},r=function(e){var t=JSON.parse(e.body);p.hideModal().then((function(){p.show("Your application could not be saved",t.message).then((function(){ie.disabled=!1,re.disabled=!1,p.showModal("app-editor-modal")}))}))};we?f.post("https://".concat(o,"/v4/applications"),JSON.stringify(t),e).then(n).catch(r):f.start("PATCH","https://".concat(o,"/v4/applications/").concat(t.applicationId),JSON.stringify(t),e).then(n).catch(r)};se&&1===se.files.length?(n=se.files[0],new Promise((function(e,t){var a=new FileReader;a.onload=function(){e(a.result)},a.onerror=t,a.readAsBinaryString(n)}))).then((function(e){t.iconData=btoa(e),r()})).catch((function(e){p.show("Unable to read icon data",e.message)})):r()})),re.addEventListener("click",(function(e){e.preventDefault(),p.hideModal()})),ve&&me.addEventListener("change",(function(){me.checked?ve.classList.remove("hidden"):ve.classList.add("hidden")})),ce.addEventListener("click",(function(e){e.preventDefault(),se.click()})),se.addEventListener("change",(function(){if(1!==se.files.length)return le.setAttribute("src","https://assets.usebeacon.app/images/avatars/default/64px.png"),le.setAttribute("srcset","https://assets.usebeacon.app/images/avatars/default/64px.png, https://assets.usebeacon.app/images/avatars/default/128px.png 2x, https://assets.usebeacon.app/images/avatars/default/256px.png 3x"),void(ue&&ue.classList.add("hidden"));le.setAttribute("src",URL.createObjectURL(se.files[0])),le.removeAttribute("srcset"),ue&&ue.classList.remove("hidden")}))}var Te,Ie=document.getElementById("static-token-modal"),Le=document.getElementById("static-token-name-field"),Be=document.getElementById("static-token-token-field"),Ae=document.getElementById("static-token-cancel-button"),xe=document.getElementById("static-token-action-button"),Pe=document.getElementById("static-token-provider-field"),_e=document.getElementById("static-token-generate-link"),Oe=document.getElementById("static-token-help-field"),Me=document.getElementById("static-token-error-field"),Ue=function(e){e.preventDefault();var t=e.currentTarget.getAttribute("beacon-provider"),n=e.currentTarget.getAttribute("beacon-provider-type"),r=e.currentTarget.getAttribute("beacon-token-id"),i=e.currentTarget.getAttribute("beacon-token-name");if(""===r)switch(n){case"oauth":window.location="/account/oauth/v4/begin/".concat(t);break;case"static":if(Ie&&Le&&Be&&Pe&&_e&&Oe){switch(Le.value="",Be.value="",Pe.value=t,Me.classList.add("hidden"),t){case"nitrado":_e.href="https://server.nitrado.net/usa/developer/tokens",Oe.innerText='Beacon requires long life tokens from Nitrado to have the "service" scope enabled.',Oe.classList.remove("hidden");break;case"gameserverapp.com":_e.href="https://dash.gameserverapp.com/configure/api",Oe.innerText='On your GameServerApp.com dashboard, you will find an "API / Integrate" option where you can issue a token for Beacon. Copy the token into the field below to continue. Remember to keep your token in a safe place in case you need it again.',Oe.classList.remove("hidden")}p.showModal("static-token-modal")}}else p.confirm("Are you sure you want to remove the service ".concat(i,"?"),"You will be able to connect the service again if you choose to.","Delete","Cancel").then((function(){f.delete("https://".concat(o,"/v4/tokens/").concat(r),{"X-Beacon-Token":a}).then((function(){window.location.reload(!0)})).catch((function(){p.show("The service was not deleted.")}))}))},je=y(document.querySelectorAll('#panel-account div[page="services"] .service-action button'));try{for(je.s();!(Te=je.n()).done;)Te.value.addEventListener("click",Ue)}catch(e){je.e(e)}finally{je.f()}if(Ie&&Le&&Be&&Ae&&xe&&Pe&&Me){var Ce=function(){xe.disabled=""===Le.value.trim()||""===Be.value.trim()};Le.addEventListener("input",(function(){Ce()})),Be.addEventListener("input",(function(){Ce()})),Ae.addEventListener("click",(function(e){e.preventDefault(),p.hideModal()})),xe.addEventListener("click",(function(e){e.preventDefault(),xe.disabled=!0,Me.classList.add("hidden");var t={provider:Pe.value,type:"Static",accessToken:Be.value.trim(),providerSpecific:{tokenName:Le.value.trim()}};f.post("https://".concat(o,"/v4/user/tokens"),t,{"X-Beacon-Token":a}).then((function(){window.location.reload(!0)})).catch((function(e){try{var t=JSON.parse(e.body);Me.innerText=t.message}catch(e){Me.innerText="Could not save token."}Me.classList.remove("hidden"),xe.disabled=!1}))}))}var Ne=new URLSearchParams(window.location.search);if(Ne.get("message")&&Ne.get("explanation")){p.show(Ne.get("message"),Ne.get("explanation"));var De=new(window.URL||window.webkitURL||window.mozURL||window.msURL||window.oURL)(window.location);De.search="",window.history.replaceState(null,document.title,De.toString())}var Re=document.getElementById("openBillingPortalButton");Re&&Re.addEventListener("click",(function(e){e.preventDefault(),Re.disabled=!0;var t=new URLSearchParams;t.append("returnUrl",Re.getAttribute("return-url")),f.get("https://".concat(o,"/v4/user/billingPortal?").concat(t.toString()),{"X-Beacon-Token":a}).then((function(e){Re.disabled=!1;try{var t=JSON.parse(e.body);window.location.href=t.portalUrl}catch(e){p.show("Could not open your billing portal.","There was an unexpected error.")}})).catch((function(){Re.disabled=!1,p.show("Could not open your billing portal.","Sorry about that. This can happen with older logins. Try signing out and signing back in.")}))}))}))})();