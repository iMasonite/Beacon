(()=>{"use strict";var e;function t(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class n{static show(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Ok";return this.confirm(e,t,n,null)}static confirm(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Ok",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Cancel",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return new Promise(((s,l)=>{const a=document.getElementById("overlay"),c=document.getElementById("dialog"),r=document.getElementById("dialog_message"),d=document.getElementById("dialog_explanation"),u=document.getElementById("dialog_slot"),m=document.getElementById("dialog_action_button"),h=document.getElementById("dialog_cancel_button");a&&c&&r&&d&&m&&h?(a.className="exist",c.className="exist",setTimeout((()=>{a.className="exist visible",c.className="exist visible"}),10),r.innerText=e,t?(d.innerText=t,d.classList.remove("hidden")):(d.innerText="",d.classList.add("hidden")),u&&(o?(u.innerHTML=o,u.classList.remove("hidden")):(u.innerText="",u.classList.add("hidden"))),m.clickHandler&&m.removeEventListener("click",m.clickHandler),h.clickHandler&&h.removeEventListener("click",h.clickHandler),m.clickHandler=()=>{this.hide(),setTimeout((()=>{s()}),300)},m.addEventListener("click",m.clickHandler),m.innerText=n,i?(h.clickHandler=()=>{this.hide(),setTimeout((()=>{l()}),300)},h.addEventListener("click",h.clickHandler),h.innerText=i):h.className="hidden"):l()}))}static hide(){var e=document.getElementById("overlay"),t=document.getElementById("dialog");e&&t&&(e.className="exist",t.className="exist",setTimeout((()=>{e.className="",t.className=""}),300))}static showModal(e){if(this.activeModal)return;const t=document.getElementById("overlay"),n=document.getElementById(e);t&&n&&(t.classList.add("exist"),n.classList.add("exist"),this.activeModal=e,setTimeout((()=>{t.classList.add("visible"),n.classList.add("visible")}),10),this.viewportWatcher=setInterval((()=>{if(!this.activeModal)return;document.querySelectorAll("#".concat(this.activeModal," .modal-content .content")).forEach((e=>{n.classList.toggle("scrolled",e.scrollHeight>e.clientHeight)}));const e=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0);n.classList.toggle("centered",n.clientHeight>.75*e)}),100))}static hideModal(){return new Promise(((e,t)=>{if(!this.activeModal)return void t();const n=document.getElementById("overlay"),i=document.getElementById(this.activeModal);n&&i?(this.viewportWatcher&&(clearInterval(this.viewportWatcher),this.viewportWatcher=null),n.classList.remove("visible"),i.classList.remove("visible"),setTimeout((()=>{n.classList.remove("exist"),i.classList.remove("exist"),this.activeModal=null,e()}),300)):t()}))}}e=n,t(n,"activeModal",null),t(n,"viewportWatcher",null),t(n,"secureConfirm",(function(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Ok",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Cancel";return new Promise(((l,a)=>{let c;switch(t){case"password":c=e.confirm(n,i,o,s,'<div class="floating-label"><input type="password" class="text-field" id="dialog_confirm_field" placeholder="Account Password"><label for="dialog_confirm_field">Account Password</label></div>');break;case"anyAuthenticator":c=e.confirm(n,i,o,s,'<div class="floating-label"><input type="text" class="text-field" id="dialog_confirm_field" placeholder="Two Step Code"><label for="dialog_confirm_field">Two Step Code</label></div>');break;default:console.log("Unknown security option ".concat(t)),a("Unknown security option")}c.then((()=>{const e=document.getElementById("dialog_confirm_field");l(e.value)})).catch((()=>{a()}))}))}));class i{static prepareResponse(e){return{xhr:e,status:e.status,statusText:e.statusText,body:e.responseText,success:e.status>=200&&e.status<300||304===e.status}}static start(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new Promise(((o,s)=>{const l=new XMLHttpRequest;if(l.open(e,t,!0),"object"==typeof i&&null!==i&&!1===Array.isArray(i)){const e=Object.keys(i);for(const t of e)l.setRequestHeader(t,i[t])}l.onload=()=>{const e=this.prepareResponse(l);e.success?o(e):s(e)},l.onerror=()=>{s(this.prepareResponse(l))},l.send(n)}))}static get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i.start("GET",e,null,t)}static post(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t instanceof URLSearchParams?(n["Content-Type"]="application/x-www-form-urlencoded",i.start("POST",e,t.toString(),n)):"object"==typeof t&&null!==t||Array.isArray(t)?(n["Content-Type"]="application/json",i.start("POST",e,JSON.stringify(t),n)):i.start("POST",e,t,n)}static delete(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i.start("DELETE",e,null,t)}}let o=0;const s=e=>{const t=document.getElementById("checking_container"),l=document.getElementById("purchase_unknown"),a=document.getElementById("purchase_delayed"),c=document.getElementById("purchase_confirmed"),r=document.getElementById("signin_instructions"),d=document.getElementById("confirmed_text"),u=document.getElementById("checking_subtext"),m=document.getElementById("activate_button");if(null===e)return t.style.display="none",l.style.display="block",void(r.style.display="block");o++,i.get("status?client_reference_id=".concat(encodeURIComponent(e))).then((e=>{try{t.style.display="none",c.style.display="block";const n=JSON.parse(e.body),i=n.user_id,o=n.email,s="".concat(window.location.origin,"/account/#omni");let l="".concat(window.location.origin,"/account/login?return=").concat(encodeURIComponent(s));null!==o&&(l+="&email=".concat(encodeURIComponent(o))),null===i&&(l+="#create",null===o?(d.innerText="You will need to create an account with the email address used to purchase to activate Omni in Beacon.",m.innerText="Create Account"):(d.innertText="An email was sent to ".concat(o," to confirm your email address. Follow the included link to finish setting up your account. Be sure to check junk folders. Despite our best efforts, one of the major email providers likes to tag Beacon emails as spam."),m.className="hidden")),m.setAttribute("href",l)}catch(e){console.log(e),n.show("There was an error checking your purchase status.")}})).catch((()=>{setTimeout((()=>{1===o?u.innerText="\nWaiting for purchase details from Stripeâ€¦":(a.style.display="block",r.style.display="block"),s(e)}),5e3)}))};document.addEventListener("DOMContentLoaded",(()=>{let e=null;sessionStorage&&(e=sessionStorage.getItem("clientReferenceId")),setTimeout((()=>{s(e)}),1e3),localStorage.removeItem("beaconCart")}))})();