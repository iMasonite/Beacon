(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function n(e,t,n){return(t=o(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(t){var n=function(t,n){if("object"!==e(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,"string");if("object"!==e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===e(n)?n:String(n)}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,o;return n=e,o=[{key:"show",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Ok";return this.confirm(e,t,n,null)}},{key:"confirm",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Ok",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Cancel",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return new Promise((function(l,a){var c=document.getElementById("overlay"),s=document.getElementById("dialog"),u=document.getElementById("dialog_message"),d=document.getElementById("dialog_explanation"),m=document.getElementById("dialog_slot"),f=document.getElementById("dialog_action_button"),v=document.getElementById("dialog_cancel_button");c&&s&&u&&d&&f&&v?(c.className="exist",s.className="exist",setTimeout((function(){c.className="exist visible",s.className="exist visible"}),10),u.innerText=e,n?(d.innerText=n,d.classList.remove("hidden")):(d.innerText="",d.classList.add("hidden")),m&&(r?(m.innerHTML=r,m.classList.remove("hidden")):(m.innerText="",m.classList.add("hidden"))),f.clickHandler&&f.removeEventListener("click",f.clickHandler),v.clickHandler&&v.removeEventListener("click",v.clickHandler),f.clickHandler=function(){t.hide(),setTimeout((function(){l()}),300)},f.addEventListener("click",f.clickHandler),f.innerText=o,i?(v.clickHandler=function(){t.hide(),setTimeout((function(){a()}),300)},v.addEventListener("click",v.clickHandler),v.innerText=i):v.className="hidden"):a()}))}},{key:"hide",value:function(){var e=document.getElementById("overlay"),t=document.getElementById("dialog");e&&t&&(e.className="exist",t.className="exist",setTimeout((function(){e.className="",t.className=""}),300))}},{key:"showModal",value:function(e){var t=this;if(!this.activeModal){var n=document.getElementById("overlay"),o=document.getElementById(e);n&&o&&(n.classList.add("exist"),o.classList.add("exist"),this.activeModal=e,setTimeout((function(){n.classList.add("visible"),o.classList.add("visible")}),10),this.viewportWatcher=setInterval((function(){if(t.activeModal){document.querySelectorAll("#".concat(t.activeModal," .modal-content .content")).forEach((function(e){o.classList.toggle("scrolled",e.scrollHeight>e.clientHeight)}));var e=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0);o.classList.toggle("centered",o.clientHeight>.75*e)}}),100))}}},{key:"hideModal",value:function(){var e=this;return new Promise((function(t,n){if(e.activeModal){var o=document.getElementById("overlay"),i=document.getElementById(e.activeModal);o&&i?(e.viewportWatcher&&(clearInterval(e.viewportWatcher),e.viewportWatcher=null),o.classList.remove("visible"),i.classList.remove("visible"),setTimeout((function(){o.classList.remove("exist"),i.classList.remove("exist"),e.activeModal=null,t()}),300)):n()}else n()}))}}],null&&t(n.prototype,null),o&&t(n,o),Object.defineProperty(n,"prototype",{writable:!1}),e}();function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function l(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(void 0,i=function(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!==r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===r(i)?i:String(i)),o)}var i}n(i,"activeModal",null),n(i,"viewportWatcher",null),n(i,"secureConfirm",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Ok",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Cancel";return new Promise((function(l,a){var c;switch(e){case"password":c=i.confirm(t,n,o,r,'<div class="floating-label"><input type="password" class="text-field" id="dialog_confirm_field" placeholder="Account Password"><label for="dialog_confirm_field">Account Password</label></div>');break;case"anyAuthenticator":c=i.confirm(t,n,o,r,'<div class="floating-label"><input type="text" class="text-field" id="dialog_confirm_field" placeholder="Two Step Code"><label for="dialog_confirm_field">Two Step Code</label></div>');break;default:console.log("Unknown security option ".concat(e)),a("Unknown security option")}c.then((function(){var e=document.getElementById("dialog_confirm_field");l(e.value)})).catch((function(){a()}))}))}));var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"prepareResponse",value:function(e){return{xhr:e,status:e.status,statusText:e.statusText,body:e.responseText,success:e.status>=200&&e.status<300||304===e.status}}},{key:"start",value:function(e,t){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new Promise((function(l,a){var c=new XMLHttpRequest;if(c.open(e,t,!0),"object"===r(i)&&null!==i&&!1===Array.isArray(i))for(var s=0,u=Object.keys(i);s<u.length;s++){var d=u[s];c.setRequestHeader(d,i[d])}c.onload=function(){var e=n.prepareResponse(c);e.success?l(e):a(e)},c.onerror=function(){a(n.prepareResponse(c))},c.send(o)}))}},{key:"get",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.start("GET",t,null,n)}},{key:"post",value:function(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n instanceof URLSearchParams?(o["Content-Type"]="application/x-www-form-urlencoded",e.start("POST",t,n.toString(),o)):"object"===r(n)&&null!==n||Array.isArray(n)?(o["Content-Type"]="application/json",e.start("POST",t,JSON.stringify(n),o)):e.start("POST",t,n,o)}},{key:"delete",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.start("DELETE",t,null,n)}}],null&&l(t.prototype,null),n&&l(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),c=0,s=function e(t){var n=document.getElementById("checking_container"),o=document.getElementById("purchase_unknown"),r=document.getElementById("purchase_delayed"),l=document.getElementById("purchase_confirmed"),s=document.getElementById("signin_instructions"),u=document.getElementById("confirmed_text"),d=document.getElementById("checking_subtext"),m=document.getElementById("activate_button");if(null===t)return n.style.display="none",o.style.display="block",void(s.style.display="block");c++,a.get("status?client_reference_id=".concat(encodeURIComponent(t))).then((function(e){try{n.style.display="none",l.style.display="block";var t=JSON.parse(e.body),o=t.user_id,r=t.email,a="".concat(window.location.origin,"/account/#omni"),c="".concat(window.location.origin,"/account/login?return=").concat(encodeURIComponent(a));null!==r&&(c+="&email=".concat(encodeURIComponent(r))),null===o&&(c+="#create",null===r?(u.innerText="You will need to create an account with the email address used to purchase to activate Omni in Beacon.",m.innerText="Create Account"):(u.innertText="An email was sent to ".concat(r," to confirm your email address. Follow the included link to finish setting up your account. Be sure to check junk folders. Despite our best efforts, one of the major email providers likes to tag Beacon emails as spam."),m.className="hidden")),m.setAttribute("href",c)}catch(e){console.log(e),i.show("There was an error checking your purchase status.")}})).catch((function(){setTimeout((function(){1===c?d.innerText="\nWaiting for purchase details from Stripeâ€¦":(r.style.display="block",s.style.display="block"),e(t)}),5e3)}))};document.addEventListener("DOMContentLoaded",(function(){var e=null;sessionStorage&&(e=sessionStorage.getItem("clientReferenceId")),setTimeout((function(){s(e)}),1e3),localStorage.removeItem("beaconCart")}))})();